<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Session功能实现 | 技术文档</title>
    <meta name="description" content="技术文档">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.DldlMWUY.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.frMSdckR.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.DwXaX3Ib.js">
    <link rel="modulepreload" href="/assets/chunks/framework.BlzMDYBM.js">
    <link rel="modulepreload" href="/assets/golang_04.session.md.Bb8hcKGS.lean.js">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>技术文档</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/linux/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Linux</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tools/markdown.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Markdown</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/golang/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Golang</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/rust/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Rust</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Linux基本的使用</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/index.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Linux基本命令</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/install-ubuntu.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>制作ubuntu安装U盘</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/jenkins.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ubuntu安装Jenkins</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/redis.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ubuntu安装Redis</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/sh.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ubuntu安装shadowsocks</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/ubuntu-server.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ubuntu安装web服务器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/ubuntu.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ubuntu服务器优化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/ubuntu-install-rn-env.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ubuntu安装React Native环境</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/mongodb.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>mongoDB数据基本操作</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/ubuntu-command.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ubuntu部署代理服务器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/nodejs.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>nvm安装nodejs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/centos.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>CentOS系统基本配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/centos-mysql.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>CentOS系统安装mysql</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/linux/freebsd.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>FreeBSD服务器基本配置</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>TypeScript 文档</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/typescript/0_in.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>简介</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/typescript/1_type.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>基本类型</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/typescript/2_interface.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>接口</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/typescript/3_class.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>类</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/typescript/4_function.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>函数</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/typescript/5_generic.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>泛型</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/typescript/6_other.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>其他</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Vue3 文档</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vue3/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vue3/sfc.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>SFC 语法规范</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vue3/sfc-tools.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>SFC 工具</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vue3/setup.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>单文件组件 setup</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vue3/sfc-style.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>单文件组件样式特性</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vue3/packages.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>常用的库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vue3/1.class" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>教案案例</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vue3/0.js" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>JaveScript语法</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Golang 文档</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Golang基本语法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/01.golang.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>服务器构建</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/02.mysql.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>mysql的存储</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/03.redis.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>数据缓存</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/04.session.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Session的使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/05.micro-server.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>微服务的架构</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/06.home.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>项目租房网</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/project.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>电商项目</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/api.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>API项目</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/lists.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>常用项目列表</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/layout.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>项目目录结构</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/designer.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>工厂模式编程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/leicrm.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>CRM项目设计</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/golang/totp.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>TOTP二次验证</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Flutter 文档</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/flutter/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Flutter 基本语法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/flutter/components.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Flutter 常用组件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/flutter/layout.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Flutter 常用布局</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/flutter/animation.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Flutter 常用动画</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/flutter/state.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Flutter 常用状态管理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/flutter/sharedsreferences.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>SharedPreferences的封装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/flutter/dart.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Dart 基本语法</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Rust 文档</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/rust/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Rust基本语法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/rust/rustlings.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Rustlings 学习</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/rust/arceos.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>arceOS开发文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/rust/cat.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Rust实现cat命令</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/rust/01.weekhomework.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Rust OS 第一周作业</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>工具的使用</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tools/think.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>协同工作流程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tools/markdown.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Markdow使用文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tools/booklists.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>电子书和文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tools/git.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>git学习文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tools/github.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>github协作开发</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tools/sql.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>SQL语法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tools/matrix-synapse.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>matrix通信服务框架</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tools/driver.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>kernel驱动开发</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/tools/36ask.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>心理学-亚瑟·阿伦36问</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Mermaid 文档</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/mermaid/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/mermaid/flowchart.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>流程图样式</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/mermaid/examples.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>常用样式案例</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>面试题</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/interview/h5.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Web前端面试题</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>少儿教育</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/index.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/4.hua.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>少儿编程话术</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/1.class" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>教学要求</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/lunwen1.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>小学生空间认知与数学发展关系</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/1.cpp.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>C++课程简介</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/2.python.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Python课程简介</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/3.scratch.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Scratch课程简介</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/6.lego.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>小颗粒课程简介</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/7.lego.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>大颗粒课程简介</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/0.together.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>合作方案</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/xuanchuandan.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>宣传单</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/kidsedu/richard.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>王老师简介</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _golang_04_session" data-v-39a288b8><div><h1 id="session功能实现" tabindex="-1">Session功能实现 <a class="header-anchor" href="#session功能实现" aria-label="Permalink to &quot;Session功能实现&quot;">​</a></h1><h2 id="_1-1业务流程图" tabindex="-1">1.1业务流程图 <a class="header-anchor" href="#_1-1业务流程图" aria-label="Permalink to &quot;1.1业务流程图&quot;">​</a></h2><p><img src="/images/golang/clip_image002-1542889467165.jpg" alt="111"></p><h2 id="_1-2接口定义" tabindex="-1">1.2接口定义 <a class="header-anchor" href="#_1-2接口定义" aria-label="Permalink to &quot;1.2接口定义&quot;">​</a></h2><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: GET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/session</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">data:no input data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;OK&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;13313331333&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#注册失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="_1-3具体业务实现" tabindex="-1">1.3具体业务实现 <a class="header-anchor" href="#_1-3具体业务实现" aria-label="Permalink to &quot;1.3具体业务实现&quot;">​</a></h2><p>session的处理，我们可以直接放在web端来实现，具体实现如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//定义返回数据容器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">resp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">interface</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">dataTmp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//初始化session</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">s </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> sessions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Default</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(ctx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">userName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//对获取的session校验</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> userName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//初始化返回值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_SESSIONERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_SESSIONERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_OK)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	dataTmp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> userName.(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> dataTmp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,resp)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="_2-用户信息展示" tabindex="-1">2.用户信息展示 <a class="header-anchor" href="#_2-用户信息展示" aria-label="Permalink to &quot;2.用户信息展示&quot;">​</a></h2><h3 id="_2-1业务流程图" tabindex="-1">2.1业务流程图 <a class="header-anchor" href="#_2-1业务流程图" aria-label="Permalink to &quot;2.1业务流程图&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543151932045.jpg" alt="im"></p><h3 id="_2-2接口定义" tabindex="-1">2.2接口定义 <a class="header-anchor" href="#_2-2接口定义" aria-label="Permalink to &quot;2.2接口定义&quot;">​</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: GET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/user</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">no input data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;user_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;itcast&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;110&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;real_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;传智&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;id_card&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;210112244556677&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;avatar_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:8888/group1/M00/00/00/Zciqq1n7It2ANn1dAADexS5wJKs808.png&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="_2-3服务端实现" tabindex="-1">2.3服务端实现 <a class="header-anchor" href="#_2-3服务端实现" aria-label="Permalink to &quot;2.3服务端实现&quot;">​</a></h2><p>首先我们根据接口定义来确定proto文件的参数，修改后的proto文件如下：</p><div class="language-protobuf vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">protobuf</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">syntax</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;proto3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> go.micro.srv.getUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">service</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> GetUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	rpc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	UserData</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UserData</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> mobile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> real_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> id_card </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> avatar_url </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 6</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>然后修改main.go文件，再详细的实现我们的业务方法，具体代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//根据用户名获取信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	db ,err</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">InitDb</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	user,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(db,req.Name)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_DBERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_DBERR)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> data </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UserData</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	data.Name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user.Name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	data.Mobile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user.Mobile</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	data.IdCard </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user.Id_card</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	data.RealName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user.Real_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	data.AvatarUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user.Avatar_url</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	data.UserId  </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(user.ID)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_OK)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Data  </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">data</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><blockquote><p>注意函数的封装，封装的函数如下：</p></blockquote><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//根据用户名获取当前用户信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> GetUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">db</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gorm</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,name).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">First</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">user).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user,err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_2-4web端实现" tabindex="-1">2.4web端实现 <a class="header-anchor" href="#_2-4web端实现" aria-label="Permalink to &quot;2.4web端实现&quot;">​</a></h2><p>服务端实现之后，接着我们来实现web端，首先我们要匹配相应的路由，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">r1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,controller.GetUserInfo)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后实现具体的控制器函数，首先是从session中获取数据，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//获取登录信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">s </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> sessions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Default</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(ctx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">userName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">errResp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">interface</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> userName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_SESSIONERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_SESSIONERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>然后调用远程服务，把用户名传到远程，并获取返回值，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//远程调用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">grpcService </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetGrpcService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">client </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> getUserInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewGetUserInfoService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;go.micro.srv.getUserInfo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">grpcServiceClient</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">resp,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">TODO</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(),</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{Name:userName.(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>根据返回值确定返回给前端的数据，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_DBERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_DBERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,resp)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h1 id="_3-退出登陆" tabindex="-1">3.退出登陆 <a class="header-anchor" href="#_3-退出登陆" aria-label="Permalink to &quot;3.退出登陆&quot;">​</a></h1><h2 id="_3-1业务流程图" tabindex="-1">3.1业务流程图 <a class="header-anchor" href="#_3-1业务流程图" aria-label="Permalink to &quot;3.1业务流程图&quot;">​</a></h2><p><img src="/images/golang/clip_image002-1543150703766.jpg" alt="mg"></p><h2 id="_3-2接口定义" tabindex="-1">3.2接口定义 <a class="header-anchor" href="#_3-2接口定义" aria-label="Permalink to &quot;3.2接口定义&quot;">​</a></h2><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: DELETE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/session</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">no input data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;OK&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_3-3业务实现" tabindex="-1">3.3业务实现 <a class="header-anchor" href="#_3-3业务实现" aria-label="Permalink to &quot;3.3业务实现&quot;">​</a></h2><p>退出登陆实现比较简单，直接删除session即可，首先我们来匹配一下路由，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">r1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DELETE</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/session&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,controller.DeleteSession)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后在控制器实现删除session返回数据操作，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> DeleteSession</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">interface</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//删除session</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	s </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> sessions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Default</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(ctx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Delete</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Save</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		resp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_SESSIONERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		resp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_SESSIONERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		resp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		resp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_OK)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,resp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>注意。不管是设置session还是删除session最后都需要调用save方法。</p></blockquote><h2 id="_4-登陆业务实现" tabindex="-1">4.登陆业务实现 <a class="header-anchor" href="#_4-登陆业务实现" aria-label="Permalink to &quot;4.登陆业务实现&quot;">​</a></h2><h3 id="_4-1业务流程图" tabindex="-1">4.1业务流程图 <a class="header-anchor" href="#_4-1业务流程图" aria-label="Permalink to &quot;4.1业务流程图&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543150684587.jpg" alt="im"></p><h3 id="_4-2接口定义" tabindex="-1">4.2接口定义 <a class="header-anchor" href="#_4-2接口定义" aria-label="Permalink to &quot;4.2接口定义&quot;">​</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: POST</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/sessions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#B31D28;--shiki-dark-font-style:italic;">    mobile</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;133&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//手机号</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#B31D28;--shiki-dark-font-style:italic;">    password</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;itcast&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//密码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;OK&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_4-3服务端实现" tabindex="-1">4.3服务端实现 <a class="header-anchor" href="#_4-3服务端实现" aria-label="Permalink to &quot;4.3服务端实现&quot;">​</a></h3><p>首先是创建服务，代码如下：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> src</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> project/login</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后根据接口定义，修改proto参数，修改后的proto内容如下：</p><div class="language-protobuf vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">protobuf</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">syntax</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;proto3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> go.micro.srv.login</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">service</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Login</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	rpc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> mobile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> password </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>然后编译proto文件，生成对应接口，修改Main.go文件，再具体实现登陆业务，登陆业务实现如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//初始化mysql连接    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	db,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">InitDb</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_DBERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_DBERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//对传入的密码进行md5加密，然后调用封装的函数进行登陆校验，注意后面需要把用户名存入session,所以要把name传出</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	m5 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> md5.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	m5.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">([]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.Password))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	pwdHash </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> hex.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">EncodeToString</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(m5.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Sum</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	result,name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetLoginInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(db,req.Mobile,pwdHash)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//根据结果返回数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> result{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_OK)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_DATAERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_DATAERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>封装的函数如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//根据电话号和密码判断,登录是否成功</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> GetLoginInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">db</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gorm</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">mobile</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">pwd</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;mobile = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,mobile).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">First</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">user)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user.Password_hash </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> pwd,user.Name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-4web端实现" tabindex="-1">4.4web端实现 <a class="header-anchor" href="#_4-4web端实现" aria-label="Permalink to &quot;4.4web端实现&quot;">​</a></h3><p>处理完服务端接着我们来处理web端内容， 首先是做路由匹配，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">r1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">POST</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/sessions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,controller.PostLogin)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后在具体控制器函数中实现登陆业务，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//登录处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UserLogin</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Mobile </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> `json:&quot;mobile&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Password </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> `json:&quot;password&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> PostLogin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//定义错误容器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	errResp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">interface</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{})</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> userLogin </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UserLogin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Bind</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">userLogin)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_REQERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_REQERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//远程服务调用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	grpcService </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetGrpcService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	client </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> login.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewLoginService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;go.micro.srv.login&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,grpcService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">TODO</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(),</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">login</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{Mobile:userLogin.Mobile,Password:userLogin.Password})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_LOGINERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_LOGINERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//如果返回成功,存储session</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> resp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_OK{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		s </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> sessions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Default</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(ctx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Set</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,resp.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Save</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,resp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="_5-上传用户头像业务" tabindex="-1">5.上传用户头像业务 <a class="header-anchor" href="#_5-上传用户头像业务" aria-label="Permalink to &quot;5.上传用户头像业务&quot;">​</a></h2><h3 id="_5-1业务流程图" tabindex="-1">5.1业务流程图 <a class="header-anchor" href="#_5-1业务流程图" aria-label="Permalink to &quot;5.1业务流程图&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543152066379.jpg" alt="im"></p><h3 id="_5-2接口定义" tabindex="-1">5.2接口定义 <a class="header-anchor" href="#_5-2接口定义" aria-label="Permalink to &quot;5.2接口定义&quot;">​</a></h3><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: POST</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">v1.</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">avatar</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">图片的二进制数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;avatar_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:8888/group1/M00/00/00/Zciqq1n6_L-AOB04AADexS5wJKs662.png&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //图片地址需要进行拼接</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  } </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_5-3服务端实现" tabindex="-1">5.3服务端实现 <a class="header-anchor" href="#_5-3服务端实现" aria-label="Permalink to &quot;5.3服务端实现&quot;">​</a></h3><p>首先创建服务。命令如下：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> srv</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> project/postAva</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后根据接口定义确定proto文件内容，proto文件内容如下：</p><div class="language-protobuf vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">protobuf</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">syntax</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;proto3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> go.micro.srv.postAvatar</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">service</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> PostAvatar</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	rpc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> file </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileExt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	ImgPath</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ImgPath</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> avatar_url </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><blockquote><p>这里注意，我们把文件存储的时候需要获取文件格式信息，所系需要把文件格式传递过来，头像信息上传之后需要和当前用户绑定，所以需要把用户名传递过来。</p></blockquote><p>然后编译proto并修改main.go文件，再去handler中实现具体业务，业务代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//解析出来文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	client ,_</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fdfs_client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewFdfsClient</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/etc/fdfs/client.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	uploadResp ,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UploadByBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.File,req.FileExt)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_IOERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_IOERR)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//给返回值赋值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_OK)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> imgPath </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">postAvatar</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ImgPath</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	imgPath.AvatarUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;http://192.168.137.130:8888/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">uploadResp.RemoteFileId</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">imgPath</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_5-4web端实现" tabindex="-1">5.4web端实现 <a class="header-anchor" href="#_5-4web端实现" aria-label="Permalink to &quot;5.4web端实现&quot;">​</a></h3><p>具体实现，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> PostAvatar</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//定义错误返回容器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	errResp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">interface</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取前段传递的文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fileHeader ,err</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">FormFile</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;avatar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_REQERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_REQERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//判断文件大小及格式是否正确</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileHeader.Size </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 500000</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_DATAERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_DATAERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fileExt</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Ext</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(fileHeader.Filename)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileExt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;.jpg&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileExt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;.png&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileExt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;.jpeg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_DATAERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_DATAERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取文件流,并写成字节格式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	file ,_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">fileHeader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Open</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    buffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">([]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,fileHeader.Size)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	file.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Read</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(buffer)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取用户名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	s </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> sessions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Default</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(ctx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	userName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//调用远程服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	grpcService </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetGrpcService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	client </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> postAva.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewPostAvatarService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;go.micro.srv.postAvatar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,grpcService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp ,err</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">TODO</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(),</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">postAva</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		FileExt:fileExt,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		File:buffer,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Name:userName.(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_IOERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_IOERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,resp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h2 id="_6-更新用户名" tabindex="-1">6.更新用户名 <a class="header-anchor" href="#_6-更新用户名" aria-label="Permalink to &quot;6.更新用户名&quot;">​</a></h2><h3 id="_6-1业务流程图" tabindex="-1">6.1业务流程图 <a class="header-anchor" href="#_6-1业务流程图" aria-label="Permalink to &quot;6.1业务流程图&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543152217047.jpg" alt="im"></p><h3 id="_6-2接口定义" tabindex="-1">6.2接口定义 <a class="header-anchor" href="#_6-2接口定义" aria-label="Permalink to &quot;6.2接口定义&quot;">​</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: PUT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/user/name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;panda&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;Panda&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_6-3服务端实现" tabindex="-1">6.3服务端实现 <a class="header-anchor" href="#_6-3服务端实现" aria-label="Permalink to &quot;6.3服务端实现&quot;">​</a></h3><h3 id="_6-4web端实现" tabindex="-1">6.4web端实现 <a class="header-anchor" href="#_6-4web端实现" aria-label="Permalink to &quot;6.4web端实现&quot;">​</a></h3><h2 id="_7-检查用户实名认证" tabindex="-1">7.检查用户实名认证 <a class="header-anchor" href="#_7-检查用户实名认证" aria-label="Permalink to &quot;7.检查用户实名认证&quot;">​</a></h2><h3 id="_7-1业务流程图" tabindex="-1">7.1业务流程图 <a class="header-anchor" href="#_7-1业务流程图" aria-label="Permalink to &quot;7.1业务流程图&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543152417782.jpg" alt="im"></p><h3 id="_7-2接口定义" tabindex="-1">7.2接口定义 <a class="header-anchor" href="#_7-2接口定义" aria-label="Permalink to &quot;7.2接口定义&quot;">​</a></h3><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: GET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">v1.</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">auth</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">no input data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;user_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;Panda&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;123123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;110&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;real_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;熊猫&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;id_card&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;210112244556677&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;avatar_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1n7It2ANn1dAADexS5wJKs808.png&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_7-3服务端实现" tabindex="-1">7.3服务端实现 <a class="header-anchor" href="#_7-3服务端实现" aria-label="Permalink to &quot;7.3服务端实现&quot;">​</a></h3><h3 id="_7-4web端实现" tabindex="-1">7.4web端实现 <a class="header-anchor" href="#_7-4web端实现" aria-label="Permalink to &quot;7.4web端实现&quot;">​</a></h3><h2 id="_8-更新用户实名认证" tabindex="-1">8.更新用户实名认证 <a class="header-anchor" href="#_8-更新用户实名认证" aria-label="Permalink to &quot;8.更新用户实名认证&quot;">​</a></h2><h3 id="_8-1业务流程图" tabindex="-1">8.1业务流程图 <a class="header-anchor" href="#_8-1业务流程图" aria-label="Permalink to &quot;8.1业务流程图&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543152506873.jpg" alt="im"></p><h3 id="_8-2接口定义" tabindex="-1">8.2接口定义 <a class="header-anchor" href="#_8-2接口定义" aria-label="Permalink to &quot;8.2接口定义&quot;">​</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: POST</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/user/auth</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#B31D28;--shiki-dark-font-style:italic;">    real_name</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;熊猫&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#B31D28;--shiki-dark-font-style:italic;">    id_card</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;21011223344556677&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_8-3服务端实现" tabindex="-1">8.3服务端实现 <a class="header-anchor" href="#_8-3服务端实现" aria-label="Permalink to &quot;8.3服务端实现&quot;">​</a></h3><h3 id="_8-4web端实现" tabindex="-1">8.4web端实现 <a class="header-anchor" href="#_8-4web端实现" aria-label="Permalink to &quot;8.4web端实现&quot;">​</a></h3><h2 id="_9-获取当前用户已发布房源信息" tabindex="-1">9 获取当前用户已发布房源信息 <a class="header-anchor" href="#_9-获取当前用户已发布房源信息" aria-label="Permalink to &quot;9 获取当前用户已发布房源信息&quot;">​</a></h2><p>获取用户已发布房源信息服务（商品相关）</p><h3 id="创建命令" tabindex="-1">创建命令 <a class="header-anchor" href="#创建命令" aria-label="Permalink to &quot;创建命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;srv&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> sss/GetUserHouses</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="流程与接口" tabindex="-1">流程与接口 <a class="header-anchor" href="#流程与接口" aria-label="Permalink to &quot;流程与接口&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543153060818.jpg" alt="mg"></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: GET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/user/houses</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">no input data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;houses&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;西三旗桥东&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;area_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;昌平区&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;ctime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-06 11:16:24&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;house_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;img_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBJY-AL3m8AAS8K2x8TDE052.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;order_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;price&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;room_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;上奥世纪中心&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;user_avatar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBLFeALIEjAADexS5wJKs340.png&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;北清路郑上路&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;area_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;顺义区&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;ctime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-06 11:38:54&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;house_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;img_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBKtmAC8y8AAZcKg5PznU817.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;order_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;price&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;room_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;修正大厦302教室&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;user_avatar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBLFeALIEjAADexS5wJKs340.png&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="服务端实现" tabindex="-1">服务端实现 <a class="header-anchor" href="#服务端实现" aria-label="Permalink to &quot;服务端实现&quot;">​</a></h3><p>根据接口定义，生成对应的proto文件，proto文件内容如下：</p><div class="language-protobuf vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">protobuf</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">syntax</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;proto3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> go.micro.srv.getHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">service</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> GetHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	rpc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	houses</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> houses</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	repeated</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> houseInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houses </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> houseInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> address </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> area_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ctime </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> img_url </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> order_count </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 6</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> price </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> room_count </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 8</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> title </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 9</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user_avatar </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>然后编译proto文件，接着去main.go文件中，删除不需要的部分，并添加consul服务发现，然后去hander里面处理具体的业务代码，具体代码内容如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">e </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">req</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">rsp</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//查询数据库,根据用户名获取房源信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	db,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">InitDb</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//具体数据库操作，封装成函数，在下面展示</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	houses,user,areas,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetHouses</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(db,req.Name)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //根据返回数据，构造返回值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houseInfos </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Houses</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> k,v </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houses{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HouseInfo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.Address </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> v.Address</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.HouseId </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(v.ID)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.Ctime </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> v.CreatedAt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Format</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2006-01-02 15:04:05&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.ImgUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> v.Index_image_url</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.OrderCount </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(v.Order_count)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.Price </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(v.Price)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.RoomCount </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(v.Room_count)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.Title </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> v.Title</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.UserAvatar </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user.Avatar_url</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.AreaName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> areas[k].Name</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfos.Houses </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(houseInfos.Houses,</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">house)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;houseInfos = &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,houseInfos,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;areas = &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,areas)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //返回数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_OK)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">houseInfos</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>这里我们把数据库操作封装到函数里面，函数实现如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//根据用户名获取当前用户的房源信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> GetHouses</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">db</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gorm</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) ([]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">House</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Area</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//查询当前用户对象</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, name).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">First</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">user).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//查询当前用户对应的房屋</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houses []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">House</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">user).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Related</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">houses).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //获取各个房源对应的地址</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> areas []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Area</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _, v </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houses {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> area </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Area</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">v).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Related</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">area).Error</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		areas </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(areas, area)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houses, user, areas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="web端实现" tabindex="-1">web端实现 <a class="header-anchor" href="#web端实现" aria-label="Permalink to &quot;web端实现&quot;">​</a></h3><p>根据设计文档，这里我们给对应请求添加路由，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">r1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/user/houses&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,controller.GetUserHouses)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后到controller中实现对应请求方法，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//获取当前用户发布房源信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> GetUserHouses</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取用户名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	s </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> sessions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Default</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(ctx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	userName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//调用远程服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	grpcService </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetGrpcService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	client </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> getHouse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewGetHouseService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.GetHouseName,grpcService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">TODO</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(),</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{Name:userName.(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;resp = &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,err)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		resp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_SERVERERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		resp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_SERVERERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,resp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="_10-发布房源信息" tabindex="-1">10 发布房源信息 <a class="header-anchor" href="#_10-发布房源信息" aria-label="Permalink to &quot;10 发布房源信息&quot;">​</a></h2><p>发送（发布）房源信息服务（商品相关）</p><h3 id="创建命令-1" tabindex="-1">创建命令 <a class="header-anchor" href="#创建命令-1" aria-label="Permalink to &quot;创建命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;srv&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> sss/PostHouses</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="流程与接口-1" tabindex="-1">流程与接口 <a class="header-anchor" href="#流程与接口-1" aria-label="Permalink to &quot;流程与接口&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543153360870.jpg" alt="mg"></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: POST</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/houses</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;上奥世纪中心&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;price&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;666&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;area_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;西三旗桥东建材城1号&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;room_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;acreage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;60&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;unit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2室1厅&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;capacity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;beds&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;双人床2张&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;deposit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;200&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;min_days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;max_days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">&quot;facility&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;7&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;12&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;14&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;16&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;17&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;18&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;21&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;22&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">  &quot;data&quot;</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#B31D28;--shiki-dark-font-style:italic;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;house_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="服务端实现-1" tabindex="-1">服务端实现 <a class="header-anchor" href="#服务端实现-1" aria-label="Permalink to &quot;服务端实现&quot;">​</a></h3><p>创建服务，然后根据接口定义我们来修改服务的proto文件，proto内容如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">syntax </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;proto3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> go</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.micro.srv.postHouse;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">service PostHouse {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rpc </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(Request) returns (Response) {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">message Request {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> acreage </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> address </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> area_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> beds </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> capacity </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> deposit </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 6</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	repeated </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> facility </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> min_days </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 8</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> max_days </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 9</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> price </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> room_count </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> title </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 12</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> unit </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 13</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 14</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">message Response {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int32&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>修改main.go文件，然后到handler中实现具体服务内容，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//发布房源,插入操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	db,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">InitDb</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//向数据库中插入数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">House</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	acrea,_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.Acreage)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Acreage </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> acrea</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Address </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> req.Address</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	areaId ,_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.AreaId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.AreaId </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(areaId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Beds </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> req.Beds</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap,_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.Capacity)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Capacity </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> cap</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	dep ,_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.Deposit)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Deposit </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> dep</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	maxDays ,_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.MaxDays)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Max_days </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> maxDays</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	minDays,_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.MinDays)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Min_days </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> minDays</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	price ,_</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.Price)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Price </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> price</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Title </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> req.Title</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Unit </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> req.Unit</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	roomCount,_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.RoomCount)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.Room_count </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> roomCount</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//在model中封装插入函数，具体实现请往下看</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	houseId,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">InserHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(db,req.Name,house,req.Facility)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//设置返回值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_OK)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;house_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(houseId)}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>model中插入房源函数实现，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//发布房源</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> InserHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">db</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gorm</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">house</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> House</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">fids</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//根据用户名获取用户Id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	user.Name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,name).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">user).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //关联当前用户</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.UserId </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(user.ID)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//查询所有家具放到house里面</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _,v </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fids{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		id ,_</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(v)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fac </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Facility</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;id = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,id).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">fac).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house.Facilities </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.Facilities,</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">fac)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house.ID, db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Create</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">house).Error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="web端实现-1" tabindex="-1">web端实现 <a class="header-anchor" href="#web端实现-1" aria-label="Permalink to &quot;web端实现&quot;">​</a></h3><p>根据接口文档定义，给对应请求添加路由对应，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">r1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">POST</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/houses&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,controller.PostHouses)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后到controller中实现具体操作，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HouseInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Title </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> `json:&quot;title&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Acreage </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> `json:&quot;acreage&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Address </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> 	`json:&quot;address&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	AreaId </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">  `json:&quot;area_id&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Beds </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    `json:&quot;beds&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Capacity </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> `json:&quot;capacity&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Deposit </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> `json:&quot;deposit&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Facility []</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> `json:&quot;facility&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	MaxDays </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> `json:&quot;max_days&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	MinDays </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> `json:&quot;min_days&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Price </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">   `json:&quot;price&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	RoomCount </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> `json:&quot;room_count&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Unit </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    `json:&quot;unit&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//发布房源</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> PostHouses</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//定义错误容器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	errResp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">interface</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //获取前端传递过来的数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houseInfo </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HouseInfo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Bind</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">houseInfo)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_REQERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_REQERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;houseInfo = &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,houseInfo)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取当前用户名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	s </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> sessions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Default</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(ctx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	userName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//远程服务调用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	grpcService </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetGrpcService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	client </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> postHouse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewPostHouseService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.PostHouseName,grpcService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp ,err</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">TODO</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(),</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">postHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Name:userName.(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Acreage:houseInfo.Acreage,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Address:houseInfo.Address,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		AreaId:houseInfo.AreaId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Beds:houseInfo.Beds,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Capacity:houseInfo.Capacity,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Deposit:houseInfo.Deposit,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Facility:houseInfo.Facility,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		MaxDays:houseInfo.MaxDays,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		MinDays:houseInfo.MinDays,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Price:houseInfo.Price,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		RoomCount:houseInfo.RoomCount,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Title:houseInfo.Title,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		Unit:houseInfo.Unit,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //返回数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_SERVERERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_SERVERERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,resp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h2 id="_11-上传房屋图片" tabindex="-1">11 上传房屋图片 <a class="header-anchor" href="#_11-上传房屋图片" aria-label="Permalink to &quot;11 上传房屋图片&quot;">​</a></h2><p>发送（上传）房屋图片服务（商品相关）</p><h3 id="创建命令-2" tabindex="-1">创建命令 <a class="header-anchor" href="#创建命令-2" aria-label="Permalink to &quot;创建命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;srv&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> sss/PostHousesImage</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="流程与接口-2" tabindex="-1">流程与接口 <a class="header-anchor" href="#流程与接口-2" aria-label="Permalink to &quot;流程与接口&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543153464298.jpg" alt="im"></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: POST</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">表示房源id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/houses/</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/images </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/houses/:id/images </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">图片二进制数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBLmWAHlsrAAaInSze-cQ719.jpg&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="服务端实现-2" tabindex="-1">服务端实现 <a class="header-anchor" href="#服务端实现-2" aria-label="Permalink to &quot;服务端实现&quot;">​</a></h3><p>创建服务，根据接口定义，修改proto文件，proto文件内容如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">syntax </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;proto3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> go</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.micro.srv.uploadHouseImage;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">service UploadHouseImage {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rpc </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(Request) returns (Response) {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">message Request {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	bytes houseBuffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileExt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">message Response {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>修改main.go文件，添加consul服务发现，然后实现hander中具体的业务，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取fastDFS操作对象</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fdfsClient,err</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fdfs_client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewFdfsClient</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/etc/fdfs/client.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//通过字节切片上传文件到fastDFS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fdfsResp,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fdfsClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UploadByBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.HouseBuffer,req.FileExt)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//把数据存储到数据库,这里把数据库操作封装成函数，具体代码往下看</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	db,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">InitDb</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UploadHouseImage</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(db,</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.HouseId),utils.NginxPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">fdfsResp.RemoteFileId)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//返回数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_OK)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:utils.NginxPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">fdfsResp.RemoteFileId}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>models中上传房屋图片的操作代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//上传房屋图片</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UploadHouseImage</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">db</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gorm</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">houseId</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">imgUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">House</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//查询对应 房屋信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">First</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">house,houseId).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house.Index_image_url </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">house).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Update</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;index_image_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,imgUrl).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houseImage </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HouseImage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseImage.HouseId </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houseId</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Create</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">houseImage).Error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="web端实现-2" tabindex="-1">web端实现 <a class="header-anchor" href="#web端实现-2" aria-label="Permalink to &quot;web端实现&quot;">​</a></h3><p>根据接口文档，给请求添加对应路由，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">r1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">POST</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/houses/:id/images&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,controller.PostHousesImage)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>接着到controller中实现具体代码，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> PostHousesImage</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	errResp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //获取数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	houseId </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//这里我们发现，已经操作上传文件两次了，可以把上传文件操作封装成函数，代码在下面</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fileBuffer,fileExt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UploadFile</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(ctx,errResp,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;house_image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileBuffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//调用远程服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	id,_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(houseId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	grpcService </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetGrpcService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	client </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uploadHouseImage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewUploadHouseImageService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.UploadHouseImage,grpcService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">TODO</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(),</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uploadHouseImage</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		HouseId:</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(id),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		FileExt:fileExt,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		HouseBuffer:fileBuffer,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		})</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//返回数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_SERVERERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_SERVERERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,resp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>上传文件的函数封装，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UploadFile</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">errResp</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">fileName</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)([]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fileHeader,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">FormFile</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(fileName)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//校验数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_DATAERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_DATAERR)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//大小校验</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileHeader.Size </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 500000</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_MOREBIG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_MOREBIG)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//格式校验</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fileExt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Ext</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(fileHeader.Filename)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileExt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;.jpg&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileExt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;.png&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileExt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;.jepg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_FORMATERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_FORMATERR)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	file,_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fileHeader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Open</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	buffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">([]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,fileHeader.Size)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	file.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Read</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(buffer)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> buffer,fileExt[</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="_12-获取房源详细信息" tabindex="-1">12 获取房源详细信息 <a class="header-anchor" href="#_12-获取房源详细信息" aria-label="Permalink to &quot;12 获取房源详细信息&quot;">​</a></h2><p>获取房屋详细信息服务（商品相关）</p><h3 id="创建命令-3" tabindex="-1">创建命令 <a class="header-anchor" href="#创建命令-3" aria-label="Permalink to &quot;创建命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;srv&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> sss/GetHouseInfo</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="流程与接口-3" tabindex="-1">流程与接口 <a class="header-anchor" href="#流程与接口-3" aria-label="Permalink to &quot;流程与接口&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543153705596.jpg" alt="im"></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: GET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">表示房源id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/houses/</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/houses/:id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">no input data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;house&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;acreage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;西三旗桥东&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;beds&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2双人床&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;capacity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;comments&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">          &quot;comment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;评论的内容&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">          &quot;ctime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-12 12:30:30&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">          &quot;user_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;评论人的姓名&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">          &quot;comment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;评论的内容&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">          &quot;ctime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-12 12:30:30&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">          &quot;user_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;评论人的姓名&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">          &quot;comment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;评论的内容&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">          &quot;ctime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-12 12:30:30&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">          &quot;user_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;评论人的姓名&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;deposit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;facilities&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">9</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">13</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">19</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">21</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">23</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;hid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;img_urls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">        &quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBJY-AL3m8AAS8K2x8TDE052.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">        &quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBJZmAYqGWAAaInSze-cQ230.jpg&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;max_days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;min_days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;price&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;room_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;上奥世纪中心&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;unit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;3室3厅&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;user_avatar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBLFeALIEjAADexS5wJKs340.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;user_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">      &quot;user_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;Panda&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;user_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h3 id="服务端实现-3" tabindex="-1">服务端实现 <a class="header-anchor" href="#服务端实现-3" aria-label="Permalink to &quot;服务端实现&quot;">​</a></h3><p>创建服务，然后根据接口定义，修改proto文件，proto文件内容如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">syntax </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;proto3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> go</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.micro.srv.getHouseDetail;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">service GetHouseDetail {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rpc </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(Request) returns (Response) {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">message Request {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houseId </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">message Response {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	data data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">message </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	houseInfo house </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">message houseInfo {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> acreage </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> address </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> beds </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> capacity </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	repeated commentInfo comments </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> deposit </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 6</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	repeated </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> facilities </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> hid </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 8</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	repeated </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> img_urls </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 9</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> max_days </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> min_days </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> price </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 12</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> room_count </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 13</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> title </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 14</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> unit </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 15</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user_avatar </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 16</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 17</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 18</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">message </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">commentInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> comment </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ctime </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>修改main.go文件，然后去hander中实现具体业务，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//从redis数据库中获取数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> data </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getHouseDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	redisConn </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">InitRedis</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	houseBuffer, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> redis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(redisConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Do</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;get&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;houseId_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Itoa</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(req.HouseId))))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(houseBuffer) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		//如果查不到数据,就从数据库获取</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 获取数据库实例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		db, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">InitDb</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		//把具体的操作封装成函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		house, orders, orderUsers, user, facs, imgs, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(db, req.HouseId)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		//获取评论数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> comments []</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getHouseDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CommentInfo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> k, v </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> orders {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> commment </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getHouseDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CommentInfo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">			commment.Ctime </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> v.UpdatedAt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Format</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2006:01:02 15:04:05&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">			commment.UserName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> orderUsers[k].Name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">			commment.Comment </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> v.Comment</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">			comments </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(comments, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">commment)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		//获取家具数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fids []</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _, v </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> facs {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">			fids </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(fids, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(v.ID))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		//获取图片</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> imgPaths []</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		imgPaths </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(imgPaths, house.Index_image_url)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _, v </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> imgs {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">			imgPaths </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(imgPaths, v.Url)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		//设置返回数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> houseInfo </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getHouseDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HouseInfo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Acreage </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.Acreage)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Address </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house.Address</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Beds </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house.Beds</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Capacity </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.Capacity)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Comments </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> comments</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Deposit </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.Deposit)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Facilities </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fids</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Hid </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.ID)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.ImgUrls </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> imgPaths</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.MinDays </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.Min_days)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.MaxDays </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.Max_days)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Price </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.Price)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.RoomCount </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.Room_count)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Title </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house.Title</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.Unit </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house.Unit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.UserAvatar </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user.Avatar_url</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.UserId </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.UserId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		houseInfo.UserName </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user.Name</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		data.House </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">houseInfo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		data.UserId </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(user.ID)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		//把查询到的数据存储到redis中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		buffer,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> json.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Marshal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(data)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		redisConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Do</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;set&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;houseId_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Itoa</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(house.ID)),buffer)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		//如果查到数据,就直接解析数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> json.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Unmarshal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(houseBuffer,data)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//返回数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Errmsg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_OK)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">data</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><p>model中封装的函数具体内容如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//根据房屋id获取房屋信息,获取评论,用户信息,家具信息,房屋图片</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> GetDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">db</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gorm</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">houseId</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">House</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,[]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">OrderHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,[]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,[]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Facility</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,[]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HouseImage</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">House</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> orders []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">OrderHouse</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> orderUsers []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> user </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> facs []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Facility</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> imgs []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HouseImage</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	house.ID </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(houseId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">house).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">First</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">house).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house,orders,orderUsers,user,facs,imgs,err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取评论信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">house).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Related</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">orders).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house,orders,orderUsers,user,facs,imgs,err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取评论用户信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _,v </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> orders{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> orderUser </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">v).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Related</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">orderUser).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house,orders,orderUsers,user,facs,imgs,err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		orderUsers </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(orderUsers,orderUser)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取用户信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">house).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Related</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">user).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house,orders,orderUsers,user,facs,imgs,err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取家具信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">house).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Related</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">facs,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;Facilities&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house,orders,orderUsers,user,facs,imgs,err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//获取房屋图片</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">house).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Related</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">imgs).Error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house,orders,orderUsers,user,facs,imgs,err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> house,orders,orderUsers,user,facs,imgs,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="web端实现-3" tabindex="-1">web端实现 <a class="header-anchor" href="#web端实现-3" aria-label="Permalink to &quot;web端实现&quot;">​</a></h3><p>根据接口定义，给请求设置对应路由，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">r1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/houses/:id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,controller.GetHouseInfo)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后去controller中实现对应业务，代码如下：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//获取房屋详细信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> GetHouseInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //获取数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	errResp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">interface</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	houseId </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //校验数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	id,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> strconv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Atoi</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(houseId)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_REQERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_REQERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//调用远程服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	grpcService </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetGrpcService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	client </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> getDetail.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewGetHouseDetailService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.GetDetail,grpcService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	resp,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">TODO</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(),</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{HouseId:</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int32</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(id)})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //返回数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.RECODE_SERVERERR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		errResp[</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RecodeText</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(utils.RECODE_SERVERERR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,errResp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,resp)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="_13-获取首页动画图片" tabindex="-1">13 获取首页动画图片 <a class="header-anchor" href="#_13-获取首页动画图片" aria-label="Permalink to &quot;13 获取首页动画图片&quot;">​</a></h2><p>获取首页轮播图片服务（首页相关）</p><h3 id="创建命令-4" tabindex="-1">创建命令 <a class="header-anchor" href="#创建命令-4" aria-label="Permalink to &quot;创建命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;srv&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> sss/GetIndex</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="流程与接口-4" tabindex="-1">流程与接口 <a class="header-anchor" href="#流程与接口-4" aria-label="Permalink to &quot;流程与接口&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543154107047.jpg" alt="im"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">method:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> GET</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">url:api/v1.0/house/index</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#data:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">no</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> input</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> data</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#Response</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  &quot;errno&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;0&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  &quot;errmsg&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;成功&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  &quot;data&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        &quot;houses&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;house_id&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    this.Id,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;title&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">       this.Title,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;price&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">       this.Price,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;area_name&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">   this.Area.Name,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;img_url&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">     utils.AddDomain2Url</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">this.Index_image_url</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;room_count&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">  this.Room_count,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;order_count&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> this.Order_count,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;address&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">     this.Address,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;user_avatar&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> utils.AddDomain2Url</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">this.User.Avatar_url</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;ctime&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">       this.Ctime.Format</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">&quot;2006-01-02 15:04:05&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;house_id&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    this.Id,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;title&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">       this.Title,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;price&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">       this.Price,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;area_name&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">   this.Area.Name,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;img_url&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">     utils.AddDomain2Url</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">this.Index_image_url</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;room_count&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">  this.Room_count,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;order_count&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> this.Order_count,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;address&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">     this.Address,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;user_avatar&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> utils.AddDomain2Url</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">this.User.Avatar_url</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		&quot;ctime&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">       this.Ctime.Format</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">&quot;2006-01-02 15:04:05&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">   </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    &quot;errno&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;400x&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">   //状态码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    &quot;errmsg&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h2 id="_14-搜索房源" tabindex="-1">14 搜索房源 <a class="header-anchor" href="#_14-搜索房源" aria-label="Permalink to &quot;14 搜索房源&quot;">​</a></h2><p>获取（搜索）房源服务（商品相关）</p><h3 id="创建命令-5" tabindex="-1">创建命令 <a class="header-anchor" href="#创建命令-5" aria-label="Permalink to &quot;创建命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;srv&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> sss/GetHouses</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="流程与接口-5" tabindex="-1">流程与接口 <a class="header-anchor" href="#流程与接口-5" aria-label="Permalink to &quot;流程与接口&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543154391621.jpg" alt="im"></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: GET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#adi表示地区编号</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#sd表示起始日期</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#ed表示结束日期</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#sk表示查询方式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#p表示页码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/houses?aid=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">&amp;sd=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2017-11-12</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">&amp;ed=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2017-11-30</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">&amp;sk=new</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">no input data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;current_page&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;houses&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;西三旗桥东&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;area_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;昌平区&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;ctime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-06 11:16:24&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;house_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;img_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBJY-AL3m8AAS8K2x8TDE052.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;order_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;price&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;room_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;上奥世纪中心13号楼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;user_avatar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBLFeALIEjAADexS5wJKs340.png&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;西三旗桥东&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;area_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;昌平区&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;ctime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-06 11:16:24&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;house_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;img_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBJY-AL3m8AAS8K2x8TDE052.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;order_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;price&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;room_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;上奥世纪中心18号楼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;user_avatar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBLFeALIEjAADexS5wJKs340.png&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;total_page&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h2 id="_15-发布订单" tabindex="-1">15 发布订单 <a class="header-anchor" href="#_15-发布订单" aria-label="Permalink to &quot;15 发布订单&quot;">​</a></h2><p>发送（发布）订单服务（订单相关）</p><h3 id="创建命令-6" tabindex="-1">创建命令 <a class="header-anchor" href="#创建命令-6" aria-label="Permalink to &quot;创建命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;srv&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> sss/PostOrders</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="流程与接口-6" tabindex="-1">流程与接口 <a class="header-anchor" href="#流程与接口-6" aria-label="Permalink to &quot;流程与接口&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543154867892.jpg" alt="im"></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: POST</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/orders</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;house_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;start_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-11 21:23:49&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;end_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-12 21:23:49&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;order_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="_16-请求查看房东-租客订单信息" tabindex="-1">16 请求查看房东/租客订单信息 <a class="header-anchor" href="#_16-请求查看房东-租客订单信息" aria-label="Permalink to &quot;16 请求查看房东/租客订单信息&quot;">​</a></h2><p>获取房东/租户订单信息服务（订单相关）</p><h3 id="创建命令-7" tabindex="-1">创建命令 <a class="header-anchor" href="#创建命令-7" aria-label="Permalink to &quot;创建命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;srv&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> sss/GetUserOrder</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="流程与接口-7" tabindex="-1">流程与接口 <a class="header-anchor" href="#流程与接口-7" aria-label="Permalink to &quot;流程与接口&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543155051108.jpg" alt="im"></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: GET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/user/orders?role=custom 备注:role=custom为租客查看订单信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/user/orders?role=landlord 备注:role=landlord为房东查看被预定订单信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">no input data</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;amount&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;comment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;哈哈拒接&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;ctime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-11 21:23:49&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;end_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-29 16:00:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;img_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBJY-AL3m8AAS8K2x8TDE052.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;order_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;start_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-28 16:00:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;REJECTED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//WAIT_ACCPET,WAIT_COMMENT,REJECTED,COMPLETE,CANCELED</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;上奥世纪中心&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;amount&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1500</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;comment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;ctime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-11 01:32:10&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">15</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;end_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-24 16:00:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;img_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBJY-AL3m8AAS8K2x8TDE052.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;order_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;start_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-10 16:00:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;WAIT_COMMENT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;上奥世纪中心&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;amount&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;comment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;ctime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-10 01:46:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;end_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-11 16:00:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;img_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;http://101.200.170.171:9998/group1/M00/00/00/Zciqq1oBJY-AL3m8AAS8K2x8TDE052.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;order_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;start_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2017-11-09 16:00:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;WAIT_COMMENT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">        &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;上奥世纪中心&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h2 id="_17-房东同意-拒绝订单" tabindex="-1">17 房东同意/拒绝订单 <a class="header-anchor" href="#_17-房东同意-拒绝订单" aria-label="Permalink to &quot;17 房东同意/拒绝订单&quot;">​</a></h2><p>更新房东同意/拒绝订单（订单相关）</p><h3 id="创建命令-8" tabindex="-1">创建命令 <a class="header-anchor" href="#创建命令-8" aria-label="Permalink to &quot;创建命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;srv&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> sss/PutOrders</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="流程与接口-8" tabindex="-1">流程与接口 <a class="header-anchor" href="#流程与接口-8" aria-label="Permalink to &quot;流程与接口&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543155208535.jpg" alt="im"></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: PUT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">表示订单id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/orders/</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/orders/:id/status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;accept&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">表示接受</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;reject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">表示拒绝</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#B31D28;--shiki-dark-font-style:italic;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;accept&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}   </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="_18-用户评价订单信息" tabindex="-1">18 用户评价订单信息 <a class="header-anchor" href="#_18-用户评价订单信息" aria-label="Permalink to &quot;18 用户评价订单信息&quot;">​</a></h2><p>更新用户评价订单信息（订单相关）</p><h3 id="创建命令-9" tabindex="-1">创建命令 <a class="header-anchor" href="#创建命令-9" aria-label="Permalink to &quot;创建命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;srv&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> sss/PutComment</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="流程与接口-9" tabindex="-1">流程与接口 <a class="header-anchor" href="#流程与接口-9" aria-label="Permalink to &quot;流程与接口&quot;">​</a></h3><p><img src="/images/golang/clip_image002-1543156498014.jpg" alt="im"></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Request:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">method: PUT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">表示订单id</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/orders/</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/comment </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">url:api/v</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">/orders/:id/comment </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#data:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#B31D28;--shiki-dark-font-style:italic;">    order_id</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#B31D28;--shiki-dark-font-style:italic;">    comment</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;烂房子！&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#Response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回成功：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;成功&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">#返回失败：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;400x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//状态码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;状态错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><!----><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Updated Date: <time datetime="2025-04-17T08:47:54.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/golang/03.redis.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Pagina prior</span><span class="title" data-v-e257564d>数据缓存</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/golang/05.micro-server.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Proxima pagina</span><span class="title" data-v-e257564d>微服务的架构</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><!----><p class="copyright" data-v-e315a0ad>Copyright © 2022-2025 Richard Wang</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"code_golang_designer_00_simple_factory_readme.md\":\"BggsqZz0\",\"code_golang_designer_01_facade_readme.md\":\"zlC0pLfk\",\"code_golang_designer_02_adapter_readme.md\":\"Cz0VvFGy\",\"code_golang_designer_03_singleton_readme.md\":\"BcGmsh_h\",\"code_golang_designer_04_factory_method_readme.md\":\"BfAzalhw\",\"code_golang_designer_05_abstract_factory_readme.md\":\"DJcm_kXK\",\"code_golang_designer_07_prototype_readme.md\":\"DzBQRsKJ\",\"code_golang_designer_08_mediator_readme.md\":\"CB2_7ZDO\",\"code_golang_designer_09_proxy_readme.md\":\"DY0z9OMC\",\"code_golang_designer_10_observer_readme.md\":\"C4BOqZeX\",\"code_golang_designer_11_command_readme.md\":\"pDlmwhzg\",\"code_golang_designer_12_iterator_readme.md\":\"B8HA1ffc\",\"code_golang_designer_13_composite_readme.md\":\"tRK08IEH\",\"code_golang_designer_14_template_method_readme.md\":\"B0sOZWvM\",\"code_golang_designer_15_strategy_readme.md\":\"BCKWX7AN\",\"code_golang_designer_16_state_readme.md\":\"BCQHiBYb\",\"code_golang_designer_17_memento_readme.md\":\"ClBK6FvD\",\"code_golang_designer_18_flyweight_readme.md\":\"BqO8KI7F\",\"code_golang_designer_19_interpreter_readme.md\":\"CLBOtmq8\",\"code_golang_designer_20_decorator_readme.md\":\"VVD64WVQ\",\"code_golang_designer_21_chain_of_responsibility_readme.md\":\"DfR6IdVM\",\"code_golang_designer_22_bridge_readme.md\":\"7ukE574b\",\"code_golang_designer_23_visitor_readme.md\":\"DW48JzFg\",\"flutter_animation.md\":\"DJjjv0qp\",\"flutter_components.md\":\"Dh1ORpQ8\",\"flutter_dart.md\":\"C9nqWNFl\",\"flutter_index.md\":\"ydrOxHEl\",\"flutter_layout.md\":\"CZY0lqjC\",\"flutter_sharedsreferences.md\":\"Bi85I4Ty\",\"flutter_state.md\":\"DKUZIXP9\",\"golang_01.golang.md\":\"CChIQLnC\",\"golang_02.mysql.md\":\"CbewxMb1\",\"golang_03.redis.md\":\"CCzrDOf3\",\"golang_04.session.md\":\"Bb8hcKGS\",\"golang_05.micro-server.md\":\"W_ASNX5f\",\"golang_06.home.md\":\"D8eQcO55\",\"golang_api.md\":\"CCmzC3-f\",\"golang_designer.md\":\"DPYVTmme\",\"golang_index.md\":\"BJa1jf6w\",\"golang_layout.md\":\"H-LTtYNg\",\"golang_leicrm.md\":\"DaO83Fwb\",\"golang_lists.md\":\"BaBWegdo\",\"golang_project.md\":\"HNneOU8d\",\"golang_totp.md\":\"rqIzl_4n\",\"index.md\":\"JJ-pkc5H\",\"interview_h5.md\":\"DHSC8H3_\",\"kidsedu_0.together.md\":\"Bgk3sXkq\",\"kidsedu_1.class.md\":\"B5Bo2my2\",\"kidsedu_1.cpp.md\":\"D44ZPJYw\",\"kidsedu_2.python.md\":\"mZs_kpTN\",\"kidsedu_3.scratch.md\":\"Bwat2UeN\",\"kidsedu_4.hua.md\":\"DY6wDk4H\",\"kidsedu_6.lego.md\":\"R5OxR9Ui\",\"kidsedu_7.lego.md\":\"BJGwhXEd\",\"kidsedu_index.md\":\"D0zzns5Q\",\"kidsedu_letter.md\":\"CzCIyz0P\",\"kidsedu_lunwen1.md\":\"DX1pYyt6\",\"kidsedu_richard.md\":\"CgG6JD1y\",\"kidsedu_xuanchuandan.md\":\"OEv-xLAw\",\"kidsedu_全新幼儿园的少儿编程教学课程体系.md\":\"B0xGoUdB\",\"linux_centos-mysql.md\":\"CF4RlEe-\",\"linux_centos.md\":\"qy-uu4e_\",\"linux_freebsd.md\":\"D-lyMBsu\",\"linux_index.md\":\"o_BgyjYZ\",\"linux_install-ubuntu.md\":\"CYNSD2h0\",\"linux_jenkins.md\":\"BrIO3uaG\",\"linux_mac-osx.md\":\"DJwMIkEl\",\"linux_mongodb.md\":\"DNBDFOu3\",\"linux_nodejs.md\":\"CxA-s0VT\",\"linux_pptpconfig.md\":\"BvQj5044\",\"linux_redis.md\":\"BPmeak61\",\"linux_sh.md\":\"C4Ibq0x_\",\"linux_ubuntu-command.md\":\"DnRXkazH\",\"linux_ubuntu-install-rn-env.md\":\"DeZZQiHm\",\"linux_ubuntu-server.md\":\"D7o6zSpk\",\"linux_ubuntu.md\":\"CmtsUED8\",\"mermaid_examples.md\":\"CJIxPeuS\",\"mermaid_flowchart.md\":\"Bn6TfLIq\",\"mermaid_index.md\":\"BZbhEGvd\",\"nuxtjs_https.md\":\"CheyZ6J_\",\"rust_01.weekhomework.md\":\"0H6JqOR_\",\"rust_arceos.md\":\"C6zAK6fR\",\"rust_cat.md\":\"DKsElaV1\",\"rust_index.md\":\"DAk_eE0g\",\"rust_rustlings.md\":\"BVPeVPDO\",\"tools_36ask.md\":\"BxiB257P\",\"tools_booklists.md\":\"Dw5YCcOC\",\"tools_driver.md\":\"CDaKMVY1\",\"tools_git.md\":\"Cfg6pUdu\",\"tools_github.md\":\"CWdTyPqK\",\"tools_markdown.md\":\"BwU4letA\",\"tools_matrix-synapse.md\":\"h8zthHUG\",\"tools_qemu.md\":\"DIxaOlXu\",\"tools_sql.md\":\"CM1q8I6F\",\"tools_think.md\":\"C9AIAPUQ\",\"typescript_0_in.md\":\"Dr697tQh\",\"typescript_1_type.md\":\"C7ZQcCmG\",\"typescript_2_interface.md\":\"qC7S8Jt7\",\"typescript_3_class.md\":\"0s_v75aF\",\"typescript_4_function.md\":\"yxe_l8QI\",\"typescript_5_generic.md\":\"ClwNfpkQ\",\"typescript_6_other.md\":\"DA2kqbWQ\",\"vue3_0.js.md\":\"C-qzfjoN\",\"vue3_1.class.md\":\"BcJwQdvd\",\"vue3_index.md\":\"l3zQt9ud\",\"vue3_packages.md\":\"LJvpoUCB\",\"vue3_project.md\":\"DBmLEIy8\",\"vue3_setup.md\":\"l-baB0xy\",\"vue3_sfc-style.md\":\"C84cJcus\",\"vue3_sfc-tools.md\":\"BMOQ_FVJ\",\"vue3_sfc.md\":\"C2GOWxnp\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"技术文档\",\"description\":\"技术文档\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Linux\",\"link\":\"/linux/\"},{\"text\":\"Markdown\",\"link\":\"/tools/markdown\"},{\"text\":\"Golang\",\"link\":\"/golang/\"},{\"text\":\"Rust\",\"link\":\"/rust/\"}],\"sidebar\":[{\"text\":\"Linux基本的使用\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Linux基本命令\",\"link\":\"/linux/index\"},{\"text\":\"制作ubuntu安装U盘\",\"link\":\"/linux/install-ubuntu\"},{\"text\":\"ubuntu安装Jenkins\",\"link\":\"/linux/jenkins\"},{\"text\":\"ubuntu安装Redis\",\"link\":\"/linux/redis\"},{\"text\":\"ubuntu安装shadowsocks\",\"link\":\"/linux/sh\"},{\"text\":\"ubuntu安装web服务器\",\"link\":\"/linux/ubuntu-server\"},{\"text\":\"ubuntu服务器优化\",\"link\":\"/linux/ubuntu\"},{\"text\":\"ubuntu安装React Native环境\",\"link\":\"/linux/ubuntu-install-rn-env\"},{\"text\":\"mongoDB数据基本操作\",\"link\":\"/linux/mongodb\"},{\"text\":\"ubuntu部署代理服务器\",\"link\":\"/linux/ubuntu-command\"},{\"text\":\"nvm安装nodejs\",\"link\":\"/linux/nodejs\"},{\"text\":\"CentOS系统基本配置\",\"link\":\"/linux/centos\"},{\"text\":\"CentOS系统安装mysql\",\"link\":\"/linux/centos-mysql\"},{\"text\":\"FreeBSD服务器基本配置\",\"link\":\"/linux/freebsd\"}]},{\"text\":\"TypeScript 文档\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"简介\",\"link\":\"/typescript/0_in\"},{\"text\":\"基本类型\",\"link\":\"/typescript/1_type\"},{\"text\":\"接口\",\"link\":\"/typescript/2_interface\"},{\"text\":\"类\",\"link\":\"/typescript/3_class\"},{\"text\":\"函数\",\"link\":\"/typescript/4_function\"},{\"text\":\"泛型\",\"link\":\"/typescript/5_generic\"},{\"text\":\"其他\",\"link\":\"/typescript/6_other\"}]},{\"text\":\"Vue3 文档\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"介绍\",\"link\":\"/vue3/\"},{\"text\":\"SFC 语法规范\",\"link\":\"/vue3/sfc\"},{\"text\":\"SFC 工具\",\"link\":\"/vue3/sfc-tools\"},{\"text\":\"单文件组件 setup\",\"link\":\"/vue3/setup\"},{\"text\":\"单文件组件样式特性\",\"link\":\"/vue3/sfc-style\"},{\"text\":\"常用的库\",\"link\":\"/vue3/packages\"},{\"text\":\"教案案例\",\"link\":\"/vue3/1.class\"},{\"text\":\"JaveScript语法\",\"link\":\"/vue3/0.js\"}]},{\"text\":\"Golang 文档\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Golang基本语法\",\"link\":\"/golang/\"},{\"text\":\"服务器构建\",\"link\":\"/golang/01.golang\"},{\"text\":\"mysql的存储\",\"link\":\"/golang/02.mysql\"},{\"text\":\"数据缓存\",\"link\":\"/golang/03.redis\"},{\"text\":\"Session的使用\",\"link\":\"/golang/04.session\"},{\"text\":\"微服务的架构\",\"link\":\"/golang/05.micro-server\"},{\"text\":\"项目租房网\",\"link\":\"/golang/06.home\"},{\"text\":\"电商项目\",\"link\":\"/golang/project\"},{\"text\":\"API项目\",\"link\":\"/golang/api\"},{\"text\":\"常用项目列表\",\"link\":\"/golang/lists\"},{\"text\":\"项目目录结构\",\"link\":\"/golang/layout\"},{\"text\":\"工厂模式编程\",\"link\":\"/golang/designer\"},{\"text\":\"CRM项目设计\",\"link\":\"/golang/leicrm\"},{\"text\":\"TOTP二次验证\",\"link\":\"/golang/totp\"}]},{\"text\":\"Flutter 文档\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Flutter 基本语法\",\"link\":\"/flutter/\"},{\"text\":\"Flutter 常用组件\",\"link\":\"/flutter/components\"},{\"text\":\"Flutter 常用布局\",\"link\":\"/flutter/layout\"},{\"text\":\"Flutter 常用动画\",\"link\":\"/flutter/animation\"},{\"text\":\"Flutter 常用状态管理\",\"link\":\"/flutter/state\"},{\"text\":\"SharedPreferences的封装\",\"link\":\"/flutter/sharedsreferences\"},{\"text\":\"Dart 基本语法\",\"link\":\"/flutter/dart\"}]},{\"text\":\"Rust 文档\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Rust基本语法\",\"link\":\"/rust/\"},{\"text\":\"Rustlings 学习\",\"link\":\"/rust/rustlings\"},{\"text\":\"arceOS开发文档\",\"link\":\"/rust/arceos\"},{\"text\":\"Rust实现cat命令\",\"link\":\"/rust/cat\"},{\"text\":\"Rust OS 第一周作业\",\"link\":\"/rust/01.weekhomework\"}]},{\"text\":\"工具的使用\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"协同工作流程\",\"link\":\"/tools/think\"},{\"text\":\"Markdow使用文档\",\"link\":\"/tools/markdown\"},{\"text\":\"电子书和文档\",\"link\":\"/tools/booklists\"},{\"text\":\"git学习文档\",\"link\":\"/tools/git\"},{\"text\":\"github协作开发\",\"link\":\"/tools/github\"},{\"text\":\"SQL语法\",\"link\":\"/tools/sql\"},{\"text\":\"matrix通信服务框架\",\"link\":\"/tools/matrix-synapse\"},{\"text\":\"kernel驱动开发\",\"link\":\"/tools/driver\"},{\"text\":\"心理学-亚瑟·阿伦36问\",\"link\":\"/tools/36ask\"}]},{\"text\":\"Mermaid 文档\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"介绍\",\"link\":\"/mermaid/\"},{\"text\":\"流程图样式\",\"link\":\"/mermaid/flowchart\"},{\"text\":\"常用样式案例\",\"link\":\"/mermaid/examples\"}]},{\"text\":\"面试题\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Web前端面试题\",\"link\":\"/interview/h5\"}]},{\"text\":\"少儿教育\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"介绍\",\"link\":\"/kidsedu/index\"},{\"text\":\"少儿编程话术\",\"link\":\"/kidsedu/4.hua\"},{\"text\":\"教学要求\",\"link\":\"/kidsedu/1.class\"},{\"text\":\"小学生空间认知与数学发展关系\",\"link\":\"/kidsedu/lunwen1\"},{\"text\":\"C++课程简介\",\"link\":\"/kidsedu/1.cpp\"},{\"text\":\"Python课程简介\",\"link\":\"/kidsedu/2.python\"},{\"text\":\"Scratch课程简介\",\"link\":\"/kidsedu/3.scratch\"},{\"text\":\"小颗粒课程简介\",\"link\":\"/kidsedu/6.lego\"},{\"text\":\"大颗粒课程简介\",\"link\":\"/kidsedu/7.lego\"},{\"text\":\"合作方案\",\"link\":\"/kidsedu/0.together\"},{\"text\":\"宣传单\",\"link\":\"/kidsedu/xuanchuandan\"},{\"text\":\"王老师简介\",\"link\":\"/kidsedu/richard\"}]}],\"footer\":{\"license\":{\"text\":\"MIT License\",\"link\":\"https://opensource.org/licenses/MIT\"},\"copyright\":\"Copyright © 2022-2025 Richard Wang\"},\"lastUpdatedText\":\"Updated Date\",\"docFooter\":{\"prev\":\"Pagina prior\",\"next\":\"Proxima pagina\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>