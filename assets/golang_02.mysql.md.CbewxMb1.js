import{j as i,c as a,b as n,ag as l}from"./chunks/framework.BlzMDYBM.js";const h="/images/golang/1582249051388.png",p="/images/golang/1582255572530.png",c=JSON.parse('{"title":"ORM 框架","description":"","frontmatter":{"sidebar_position":2},"headers":[],"relativePath":"golang/02.mysql.md","filePath":"golang/02.mysql.md","lastUpdated":1744879674000}'),t={name:"golang/02.mysql.md"};function e(k,s,r,d,g,y){return n(),a("div",null,s[0]||(s[0]=[l('<h1 id="orm-框架" tabindex="-1">ORM 框架 <a class="header-anchor" href="#orm-框架" aria-label="Permalink to &quot;ORM 框架&quot;">​</a></h1><h2 id="orm-框架介绍" tabindex="-1">ORM 框架介绍 <a class="header-anchor" href="#orm-框架介绍" aria-label="Permalink to &quot;ORM 框架介绍&quot;">​</a></h2><ul><li>ORM：Object Relational Mapping —— 对象关系映射。</li></ul><p><img src="'+h+`" alt="1582249051388"></p><ul><li><p>作用：</p><ul><li>通过操作结构体对象，来达到操作数据库表的目的。</li><li>通过结构体对象，来生成数据库表。</li></ul></li><li><p>优点：</p><ul><li>SQL有可能 比较复杂。（Oracle --- 子查询 -- 嵌套）ORM 操作数据库，不需要使用 SQL</li><li>不同开发者，书写的 SQL 语句执行效率不同。</li></ul></li><li><p>go语言支持的 ORM：</p><ul><li>gORM：<a href="http://gorm.book.jasperxu.com/" target="_blank" rel="noreferrer">http://gorm.book.jasperxu.com/</a></li><li>xORM：</li></ul></li></ul><h1 id="gorm-连接数据库、建表" tabindex="-1">gorm 连接数据库、建表 <a class="header-anchor" href="#gorm-连接数据库、建表" aria-label="Permalink to &quot;gorm 连接数据库、建表&quot;">​</a></h1><ul><li><p>grom 操作的都是表、表数据。—— 不能操作数据库！使用SQL配合完成。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> database</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> 库名</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> charset</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">utf8;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ul><h2 id="回顾mysql" tabindex="-1">回顾MySQL <a class="header-anchor" href="#回顾mysql" aria-label="Permalink to &quot;回顾MySQL&quot;">​</a></h2><ol><li>确认mysql服务，启动：<code> ps xua | grep mysql</code></li><li>连接MySQL数据库： mysql -uroot -p123456</li><li>查看数据库：show databases;</li><li>删除数据库：drop database t1; t1 代表库名。</li><li>选择数据库、查看表：use 数据库名； show tables；</li><li>创建数据库： create database test charset=utf8;</li></ol><h2 id="gorm-操作-mysql-数据库" tabindex="-1">gORM 操作 MySQL 数据库 <a class="header-anchor" href="#gorm-操作-mysql-数据库" aria-label="Permalink to &quot;gORM 操作 MySQL 数据库&quot;">​</a></h2><h3 id="创建表" tabindex="-1">创建表 <a class="header-anchor" href="#创建表" aria-label="Permalink to &quot;创建表&quot;">​</a></h3><ol><li><p>连接数据库</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">github.com/jinzhu/gorm</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	_ </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">github.com/go-sql-driver/mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   //&quot;_&quot; 代码不直接使用包, 底层链接要使用!</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// mysql: 数据库的驱动名</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 链接数据库 --格式: 用户名:密码@协议(IP:port)/数据库名？xxx&amp;yyy&amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">conn, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> gorm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Open</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;mysql&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;root:123456@tcp(127.0.0.1:3306)/test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;gorm.Open err:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">defer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Close</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li><li><p>创建数据库表。 ——不能使用gorm创建数据库。 提前使用 SQL语句，创建好想要的数据库。</p><p>AutoMigrate() 创建表。默认创建的表 为 复数类型。—— 自动添加 “s”</p><p>在创建之前， 添加 <code> conn.SingularTable(true)</code> 可以创建非复数表名的表。</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 不要复数表名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SingularTable</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 借助 gorm 创建数据库表.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">AutoMigrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)).Error)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p>查看</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">mysql</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">desc</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> student</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">+-------+--------------+------+-----+---------+----------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Field</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Null</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Key</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Default</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Extra</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">          |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">+-------+--------------+------+-----+---------+----------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> int(11</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)      </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> NO</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">   |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> PRI</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> auto_increment</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> varchar(255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> YES</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    |</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> age</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">   |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> int(11</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)      </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> YES</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    |</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">+-------+--------------+------+-----+---------+----------------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol><h3 id="mysql-包的-init-方法" tabindex="-1">MySQL 包的 init 方法 <a class="header-anchor" href="#mysql-包的-init-方法" aria-label="Permalink to &quot;MySQL 包的 init 方法&quot;">​</a></h3><ol><li><p><code>_ &quot;github.com/go-sql-driver/mysql&quot;</code> 导入包时， “_” ,表示，驱使go系统，在main() 函数被调用之前，自动调用 init() 函数。</p></li><li><p>go语言中有两个特殊函数： —— 首字母小写，包外可见 。</p><ol><li>main() —— 项目的入口函数</li><li>init() —— 当导包，但没有在程序中使用。 在main() 调用之前，自动被调用。 <ul><li>查看：光标置于 MySQL包的 “mysql” 上。 使用 Ctrl-鼠标左键。 看到源码。 在 driver.go 底部包含 init() 函数的 定义。</li><li>init() 作用：实现注册 MySQL 驱动。</li></ul></li></ol></li><li><p>测试：</p><p>test2/ 中</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> 创建 test2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> 目录， 在内部添加 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">init</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> test2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 首字母小写函数, 包作用域, 不能跨包使用!</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> init</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;测试 init 函数 ....&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>test/ 中</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">github.com/jinzhu/gorm</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	_ </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">bj38web/web/test2</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   //&quot;_&quot; 代码不直接使用包, 底层链接要使用!</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;----this is main ---&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">输出：	测试 init 函数 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">再输出：</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">----</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">this is main </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">---</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ol><p>运行结果： init 函数 会先于 main() 函数被调用！！！</p><h3 id="gorm的连接池" tabindex="-1">gorm的连接池 <a class="header-anchor" href="#gorm的连接池" aria-label="Permalink to &quot;gorm的连接池&quot;">​</a></h3><ol><li><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> 默认， grom框架创建好的MySQL数据库连接 conn ，就是一个连接池的句柄。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">conn, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> gorm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Open</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;mysql&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;root:123456@tcp(127.0.0.1:3306)/test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>初始化全局变量， 接收句柄</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建全局连接池句柄</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> GlobalConn </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gorm</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> conn</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>修改连接池初始属性</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 初始数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetMaxIdleConns</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 最大数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetMaxOpenConns</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>使用连接池句柄</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> 对比redis连接池：不需要使用 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() 方法，取一条连接。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 不要复数表名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SingularTable</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 借助 gorm 创建数据库表.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">AutoMigrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)).Error)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol><h1 id="gorm-操作数据库数据" tabindex="-1">gorm 操作数据库数据 <a class="header-anchor" href="#gorm-操作数据库数据" aria-label="Permalink to &quot;gorm 操作数据库数据&quot;">​</a></h1><h2 id="gorm-插入数据" tabindex="-1">gorm 插入数据 <a class="header-anchor" href="#gorm-插入数据" aria-label="Permalink to &quot;gorm 插入数据&quot;">​</a></h2><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// insert into student(name, age) values(&#39;zhangsan&#39;, 100)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> InsertData</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 先创建数据 --- 创建对象</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> stu </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	stu.Name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;zhangsan&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	stu.Age </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 插入(创建)数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Create</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu).Error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>使用注意事项：</p><ul><li>插入数据时，使用的 create() 函数，传参时，必须传入 &amp;对象。 如果遗漏 “&amp;” 会报错：</li></ul><p><img src="`+p+`" alt="1582255572530"></p><ul><li>要保证 ，在插入数据库时，<code>GlobalConn.SingularTable(true)</code> 生效。代表不使用 复数表名。</li></ul><h2 id="gorm-查询数据" tabindex="-1">gorm 查询数据 <a class="header-anchor" href="#gorm-查询数据" aria-label="Permalink to &quot;gorm 查询数据&quot;">​</a></h2><h3 id="简单查询方法" tabindex="-1">简单查询方法： <a class="header-anchor" href="#简单查询方法" aria-label="Permalink to &quot;简单查询方法：&quot;">​</a></h3><ol><li><p>First(&amp;suer):</p><ul><li><p>获取 user 表中的第一条数据</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SearchData</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> stu </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">First</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(stu)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p>相当于SQL：<code> SELECT * FROM student ORDER BY id LIMIT 1;</code></p></li><li><p>只查询 name、age 不查询其他值：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Select</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name, age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">First</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ul></li><li><p>Last(&amp;user)</p><ul><li>获取 user 表中的最后一条数据</li><li>相当于SQL：<code> SELECT * FROM users ORDER BY id DESC LIMIT 1</code></li></ul></li><li><p>Find(&amp;user)</p><ul><li><p>获取 user 表中的所有数据。</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> stu []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 改为切片</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Select</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name, age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu)   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Find() 查询多条</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>相当于SQL：<code>select name, age from student;</code></p></li></ul></li></ol><h3 id="where-子句使用" tabindex="-1">where 子句使用 <a class="header-anchor" href="#where-子句使用" aria-label="Permalink to &quot;where 子句使用&quot;">​</a></h3><ul><li><p>select name, age from student where name = ‘lisi’;</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Select</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name, age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;lisi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">或：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;lisi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Select</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name, age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>select name, age from student where name = ‘lisi’ and age = 22;</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//方法1：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Select</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name, age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;lisi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">			Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;age = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">22</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//方法2：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Select</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name, age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ? and age = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;lisi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">22</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul><h2 id="gorm-更新数据" tabindex="-1">gorm 更新数据 <a class="header-anchor" href="#gorm-更新数据" aria-label="Permalink to &quot;gorm 更新数据&quot;">​</a></h2><ol><li>Save(): 根据主键更新。 如果数据没有指定主键，不更新 ，变为 “插入”操作。</li><li>Update(): 更新一个字段。</li><li>Updates(): 更新多个字段。</li></ol><h3 id="save" tabindex="-1">save <a class="header-anchor" href="#save" aria-label="Permalink to &quot;save&quot;">​</a></h3><ul><li><p>插入：</p><ul><li><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UpdateData</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> stu </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  	stu.Name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;wangwu&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  	stu.Age </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 99</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// 没有指定 id -- 没有主键! --- 插入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Save</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu).Error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p>select * from student;</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">mysql</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> student</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">+----+----------+------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> age</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">+----+----------+------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> zhangsan</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  100</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> lisi</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   18</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  3</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> lisi</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   18</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  4</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> lisi</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   18</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  5</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> lisi</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   18</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  6</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> lisi</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   22</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  7</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> wangwu</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">   |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   99</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">+----+----------+------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ul></li><li><p>更新：</p><ul><li><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UpdateData</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  	var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> stu </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  	stu.Name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;wangwu&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  	stu.Age </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 77</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  	stu.Id </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 4</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			//指定 id -- 更新操作!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Save</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu).Error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li><li><p>查询：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">mysql</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> student</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">+----+----------+------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> age</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">+----+----------+------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> zhangsan</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  100</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> lisi</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   18</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  3</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> lisi</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   18</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  4</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> wangwu</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">   |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   77</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  5</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> lisi</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   18</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  6</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> lisi</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   22</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  7</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> wangwu</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">   |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">   99</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">+----+----------+------+</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">7</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> rows</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (0.01 </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">sec</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ul></li></ul><h3 id="update" tabindex="-1">update <a class="header-anchor" href="#update" aria-label="Permalink to &quot;update&quot;">​</a></h3><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;zhaoliu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            Update</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;lisi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).Error)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">): 指定更新 “student” 表</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;zhaoliu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)： 指定过滤条件。 </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Update</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;lisi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).Error)：指定 把 “zhaoliu” 更新成 “lisi”</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="updates" tabindex="-1">updates <a class="header-anchor" href="#updates" aria-label="Permalink to &quot;updates&quot;">​</a></h3><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;lisi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            Updates</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">interface</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{}{</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;liuqi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">77</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}).Error)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="grom-删除数据" tabindex="-1">grom 删除数据 <a class="header-anchor" href="#grom-删除数据" aria-label="Permalink to &quot;grom 删除数据&quot;">​</a></h2><h3 id="删除" tabindex="-1">删除 <a class="header-anchor" href="#删除" aria-label="Permalink to &quot;删除&quot;">​</a></h3><ul><li>物理删除。真正的执行 Delete。</li></ul><h3 id="软删除" tabindex="-1">软删除 <a class="header-anchor" href="#软删除" aria-label="Permalink to &quot;软删除&quot;">​</a></h3><ul><li><p>逻辑删除。不真正删。不执行Delete。 —— 数据无价的！</p><ul><li>创建表时，在表中添加一个 “删除字段” 。当需要删除时，更新 “删除字段”， 更新为 ：true</li><li>查询时，不查询 “删除字段” 为 null 的值。</li><li>举例：淘宝，删除订单。 手机，删除图片。</li></ul></li><li><p>实现 软删除：</p><ul><li>创建表：</li></ul><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建全局结构体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Student</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">	gorm</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Model</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// go语言中, 匿名成员 --- 继承! Student 继承 Model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Age </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> 在 “Model” 上，Ctrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">B 跳转至 Model 类定义。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Model</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	ID        </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> \`gorm:&quot;primary_key&quot;\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	CreatedAt </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Time</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	UpdatedAt </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Time</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	DeletedAt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Time</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> \`sql:&quot;index&quot;\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> Model 表由 mysql自动维护，不需要我们手动维护。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><p>执行软删除：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> 使用 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Delete</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() 参数，指定要删除的数据所在表的表名。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;lisi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Delete</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)).Error)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>验证：</p><ol><li><p>select * from student； 依然能看到 “lisi” 相关数据。 但是 。delete_at 字段。被填入数据。</p></li><li><p>在 gorm 框架中，执行 查询语句：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SearchData</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> stu []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(stu)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> 查询结果为： [ ]  </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">----</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;软删除&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> 成功！</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol></li><li><p>想 查询 “软删除”的数据：</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Unscoped</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">stu)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>想 实现 “物理删除”</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> 借助 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Unscoped</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() 执行删除。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Unscoped</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;lisi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Delete</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Student</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li></ul><h3 id="mysql-8小时-时区问题" tabindex="-1">MySQL 8小时 时区问题 <a class="header-anchor" href="#mysql-8小时-时区问题" aria-label="Permalink to &quot;MySQL 8小时 时区问题&quot;">​</a></h3><ul><li><p>MySQL默认使用的时间 ： 美国 东 8 区 时间 。 —— 北京时间 —— 差 8 小时。</p></li><li><p>在连接数据库时，添加属性：<code>?parseTime=True&amp;loc=Local</code></p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">conn, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> gorm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Open</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;mysql,                &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">root:</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">123456</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">tcp</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#B31D28;--shiki-dark-font-style:italic;">127.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">3306</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">test?parseTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">True</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">loc</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">Local</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>再执行SQL语句、gorm访问MySQL 使用 北京时间。</p></li></ul><h1 id="gorm-设置表属性" tabindex="-1">gorm 设置表属性 <a class="header-anchor" href="#gorm-设置表属性" aria-label="Permalink to &quot;gorm 设置表属性&quot;">​</a></h1><h2 id="修改表字段大小" tabindex="-1">修改表字段大小 <a class="header-anchor" href="#修改表字段大小" aria-label="Permalink to &quot;修改表字段大小&quot;">​</a></h2><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建全局结构体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Student</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Id </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Name </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">		\`gorm:&quot;size:50&quot;\`</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // string -- varchar。 默认大小255.  可以在创建表时，指定大小。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Age </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>结论：修改表属性，只能在第一次建表的时候，有效！或者给表增加新字段的时候，有效！其他场景，修改表属性 ，在 gorm 操作中，无效！</li></ul><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建全局结构体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Student</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Id    </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Name  </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> \`gorm:&quot;size:100;default:&#39;xiaoming&#39;&quot;\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Age   </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Class </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    \`gorm:&quot;not null&quot;\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="设置时间" tabindex="-1">设置时间 <a class="header-anchor" href="#设置时间" aria-label="Permalink to &quot;设置时间&quot;">​</a></h2><ul><li><p>默认MySQL数据库 有 3 种时间：</p><ul><li>date：</li><li>datetime：</li><li>timeStamp：时间戳。 —— gorm 中，只有 timeStamp</li></ul></li><li><p>如果必须使用 MySQL 数据库特有的 “数据类型”， 使用 “type” 关键字来设置。</p></li></ul><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建全局结构体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Student</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Id    </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Name  </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    \`gorm:&quot;size:100;default:&#39;xiaoming&#39;&quot;\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Age   </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Class </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">       \`gorm:&quot;not null&quot;\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	Join  </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Time</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> \`gorm:&quot;type:timestamp&quot;\`</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建 Student 表指定 timestamp类型。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h1 id="项目中使用表-的创建" tabindex="-1">项目中使用表 的创建 <a class="header-anchor" href="#项目中使用表-的创建" aria-label="Permalink to &quot;项目中使用表 的创建&quot;">​</a></h1><ol><li><p>在 项目的 web/model/ 下 创建 model.go 文件。</p></li><li><p>参照讲义《微服务项目讲义1.md》中 2.2.2 小节，将创建表的代码 添加到 model.go 。</p></li><li><p>使用 SQL语句创建 数据库 search_house。修改 InitDb() 函数。同时，指定MySQL使用的时间。初始化全局连接池句柄。</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建 数据库链接句柄</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> GlobalConn </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gorm</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> InitDb</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gorm</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	db, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> gorm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Open</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;mysql&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;root:123456@tcp(127.0.0.1:3306)/search_house?parseTime=True&amp;loc=Local&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 初始化 全局连接池句柄</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		GlobalConn </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetMaxIdleConns</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		GlobalConn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">DB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetConnMaxLifetime</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SingularTable</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">AutoMigrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">House</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Area</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Facility</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HouseImage</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">OrderHouse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> db, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li><li><p>将 InitDb() 在 web/main.go 中 调用！</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 初始化 MySQL 链接池</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">InitDb</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>运行 web/main.go , 创建 项目中需要使用的表</p></li></ol><h2 id="gorm-连接数据库" tabindex="-1">gORM 连接数据库 <a class="header-anchor" href="#gorm-连接数据库" aria-label="Permalink to &quot;gORM 连接数据库&quot;">​</a></h2><table tabindex="0"><thead><tr><th>字段名</th><th>数据类型</th></tr></thead><tbody><tr><td>id</td><td>int</td></tr><tr><td>username</td><td>char</td></tr><tr><td>password</td><td>char</td></tr><tr><td>gender</td><td>int</td></tr><tr><td>birthday</td><td>int</td></tr><tr><td>register_time</td><td>int</td></tr><tr><td>last_login_time</td><td>int</td></tr><tr><td>last_login_ip</td><td>char</td></tr><tr><td>user_level_id</td><td>int</td></tr><tr><td>nickname</td><td>char</td></tr><tr><td>mobile</td><td>char</td></tr><tr><td>register_ip</td><td>char</td></tr><tr><td>avatar</td><td>char</td></tr><tr><td>weixin_openid</td><td>char</td></tr></tbody></table>`,56)]))}const u=i(t,[["render",e]]);export{c as __pageData,u as default};
