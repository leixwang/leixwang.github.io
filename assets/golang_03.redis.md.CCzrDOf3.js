import{j as i,c as a,b as n,ag as l}from"./chunks/framework.BlzMDYBM.js";const c=JSON.parse('{"title":"Redis 数据库","description":"","frontmatter":{"sidebar_position":3},"headers":[],"relativePath":"golang/03.redis.md","filePath":"golang/03.redis.md","lastUpdated":1744879674000}'),p={name:"golang/03.redis.md"};function h(t,s,e,k,r,d){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="redis-数据库" tabindex="-1">Redis 数据库 <a class="header-anchor" href="#redis-数据库" aria-label="Permalink to &quot;Redis 数据库&quot;">​</a></h1><h2 id="redis-基本使用" tabindex="-1">Redis 基本使用 <a class="header-anchor" href="#redis-基本使用" aria-label="Permalink to &quot;Redis 基本使用&quot;">​</a></h2><ol><li>修改 配置文件。 /etc/redis/redis.conf . <ul><li>bind 地址。修改成当前主机地址。 —— 192.168.6.108</li></ul></li><li>port： <ul><li>6379</li></ul></li><li>开启 redis： <ul><li>sudo redis-server /etc/redis/redis.conf</li><li>验证 ： ps xua | grep redis —— iP 和 port</li></ul></li><li>连接 redis ： <ul><li>redis-cli -h 192.168.6.108 -p 6379</li></ul></li><li>查看所有： <ul><li>keys *</li></ul></li><li>删除所有： <ul><li>flushall</li></ul></li><li>添加一条： <ul><li>set key value —— set hello world</li></ul></li><li>获取一条： <ul><li>get key</li></ul></li></ol><h2 id="go语言操作-redis" tabindex="-1">go语言操作 Redis <a class="header-anchor" href="#go语言操作-redis" aria-label="Permalink to &quot;go语言操作 Redis&quot;">​</a></h2><ul><li><p>从 redis.cn —— 客户端 —— go语言 —— 选择 redigo —— <a href="https://godoc.org/github.com/gomodule/redigo/redis#pkg-examples" target="_blank" rel="noreferrer">https://godoc.org/github.com/gomodule/redigo/redis#pkg-examples</a> 查看 API</p></li><li><p>主要分为 3 类：</p><ol><li>连接数据库。 <ul><li>API文档中，所有以 Dial 开头。</li></ul></li><li>操作数据库。 <ul><li>Do() 函数【推荐】; Send()函数, 需要配合Flush()、Receive() 3 个函数使用。</li></ul></li><li>回复助手。 <ul><li>相当于 “类型断言”。根据使用的具体数据类型，选择调用。</li></ul></li></ol></li><li><p>添加测试案例：</p></li></ul><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">github.com/gomodule/redigo/redis</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 1. 链接数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	conn, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> redis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Dial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;tcp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;192.168.6.108:6379&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;redis Dial err:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	defer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Close</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 2. 操作数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	reply, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Do</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;set&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;itcast&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;itheima&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 3. 回复助手类函数. ---- 确定成具体的数据类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	r, e </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> redis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(reply, err)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(r, e)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="redislab" tabindex="-1">RedisLab <a class="header-anchor" href="#redislab" aria-label="Permalink to &quot;RedisLab&quot;">​</a></h4><p>使用免费的<code>RedisLab</code>连接方法:</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">github.com/gomodule/redigo/redis</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 1. 链接数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	conn, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> redis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Dial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;tcp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;redis-11014.c53.west-us.azure.cloud.redislabs.com:11014&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	defer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Close</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;redis Dial err:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2 输入密码进行验证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Send</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;SxerFQeNxzsiclXGUDbAoLGY9M5tE3gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 3. 写入数据的操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  reply, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> redis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Do</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;set&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;itcast&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;itheima&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(reply, err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 4. 读取数据的操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">  it, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> redis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Do</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;get&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;itcast&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, it, err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="redis-存储图片验证码的-uuid-和码值" tabindex="-1">Redis 存储图片验证码的 uuid 和码值 <a class="header-anchor" href="#redis-存储图片验证码的-uuid-和码值" aria-label="Permalink to &quot;Redis 存储图片验证码的 uuid 和码值&quot;">​</a></h2><h4 id="微服务端" tabindex="-1">微服务端 <a class="header-anchor" href="#微服务端" aria-label="Permalink to &quot;微服务端&quot;">​</a></h4><ol><li>修改 service/proto 中 getCaptcha.proto 的 Request 消息体，填加 uuid 成员。</li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">message Request {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uuid </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    \`\`\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">2.  使用 make 命令，重新生成 getCaptcha.proto 对应的文件。</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">3.  遵循 MVC 代码组织架构，在 service/getCaptcha/ 中 创建 model 目录</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">4.  创建 modelFunc.go 文件 封装并实现 SaveImgCode() 函数：</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">\`\`\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">go</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 存储图片id 到redis 数据库</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SaveImgCode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uuid</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 1. 链接数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	conn, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> redis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Dial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;tcp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;192.168.6.108:6379&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;redis Dial err:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	defer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Close</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 2. 写数据库  --- 有效时间 5 分钟</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	_, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Do</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;setex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, uuid, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, code)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 不需要回复助手!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    \`\`\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">5.  在 getCaptcha.go 文件的 Call() 方法中， cap.Create() 后， 调用 SaveImgCode() 传参。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">        </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">#### web端</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    1.  修改密码本！因为 微服务端 修改了 proto/  , 添加消息体成员。 需要重新拷贝 proto/ 到web</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">    2.   修改 web/controller/user.go 中 Call() 方法传参。给 Request{} 初始化。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">\`\`\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">go</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">resp, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> microClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">TODO</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(), </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getCaptcha</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{Uuid:uuid})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;未找到远程服务...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><pre><code>3. 测试验证：
    1. 确认 consul 已经启动 
    2. 启动 service/    main.go 
    3. 启动 web/   main.go
    4. 浏览器：192.168.6.108:8080/home  --- 点击“注册”。看到 图片验证码。
    5. 查看 redis 数据库， keys * 能看到 图片验证吗，对应 uuid。 校验！！
</code></pre><h3 id="开发者平台" tabindex="-1">开发者平台 <a class="header-anchor" href="#开发者平台" aria-label="Permalink to &quot;开发者平台&quot;">​</a></h3><ul><li><p>中国移动 —— 短信验证码 业务 —— 下放到各个大公司（资质）。</p></li><li><p>常用平台：</p><ol><li>聚合数据：</li><li>京东万象：</li><li>腾讯云：</li><li>阿里云（推荐）： 推荐，服务器。—— 生态好！ API接口丰富。 对应开发友好度高！</li></ol></li><li><p>资料搜索。</p><ul><li>免费：—— github</li><li>收费：—— 各种开发者平台。刁钻、生僻领域。</li><li>最后Google。</li></ul></li></ul><h4 id="注册阿里云账号" tabindex="-1">注册阿里云账号 <a class="header-anchor" href="#注册阿里云账号" aria-label="Permalink to &quot;注册阿里云账号&quot;">​</a></h4><ol><li>通过实名认证</li><li>开通短信验证码功能 —— 充值 2 元左右。</li><li>申请 AccessKey</li><li>申请签名。国内消息 —— 签名管理</li><li>申请模板。国内消息 —— 模板管理</li><li>测试使用 OpenAPI Explorer， 成功发送一条短信验证码！</li></ol><h1 id="图片验证码" tabindex="-1">图片验证码 <a class="header-anchor" href="#图片验证码" aria-label="Permalink to &quot;图片验证码&quot;">​</a></h1><h2 id="获取-注册页面-图片验证码id" tabindex="-1">获取 注册页面 图片验证码ID <a class="header-anchor" href="#获取-注册页面-图片验证码id" aria-label="Permalink to &quot;获取 注册页面 图片验证码ID&quot;">​</a></h2><ol><li><p>启动 web页面，点击“注册” 按钮。在 NetWork —— Headers 中 看到 错误信息！</p></li><li><p>从 URL中，提取 图片验证码ID 。 保存 成 uuid</p></li><li><p>查看 gin 框架 中文文档。—— “获取路径中的参数”</p></li><li><p>web/main.go 中 添加 路由匹配：</p></li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/api/v1.0/imagecode/:uuid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, controller.GetImageCd)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="5"><li>web/controller/user.go 中 ，实现回调：</li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取图片信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> GetImageCd</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">gin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	uuid </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;uuid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;uuid = &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, uuid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="图片验证码获取" tabindex="-1">图片验证码获取 <a class="header-anchor" href="#图片验证码获取" aria-label="Permalink to &quot;图片验证码获取&quot;">​</a></h2><ul><li><p>去 github 中搜索 “captcha” 关键词。 过滤 Go语言。 —— <a href="https://github.com/afocus/captcha" target="_blank" rel="noreferrer">afocus/<em>captcha</em></a></p></li><li><p>使用 go get github.com/afocus/captcha 下载源码包。</p></li><li><p>参照 github 中的示例代码，测试生成 图片验证码：</p></li></ul><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">github.com/afocus/captcha</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 按住 Ctrl ，鼠标左键点击 captcha 看到 examples， 从中可提取到 “comic.ttf”</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">image/color</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">image/png</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">net/http</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 初始化对象</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> captcha.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 设置字体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetFont</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;comic.ttf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 设置验证码大小</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetSize</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 设置干扰强度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetDisturbance</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(captcha.MEDIUM)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 设置前景色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetFrontColor</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">color</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 设置背景色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetBkgColor</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">color</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">color</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">127</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">color</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RGB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 生成字体 -- 将图片验证码, 展示到页面中.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/r&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		img, str </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Create</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, captcha.NUM)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		png.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Encode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(w, img)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">		println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(str)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 或者 自定固定的数据,来做图片内容.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/c&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		str </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;itcast&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		img </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CreateCustom</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(str)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		png.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Encode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(w, img)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 启动服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ListenAndServe</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;:8086&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h2 id="图片验证码模块集成到web" tabindex="-1">图片验证码模块集成到web <a class="header-anchor" href="#图片验证码模块集成到web" aria-label="Permalink to &quot;图片验证码模块集成到web&quot;">​</a></h2><ol><li>将 ImgTest.go 中的测试代码， 粘贴到 web/controller/user.go 中的 GetImageCd() 函数</li><li>导入需要的包。 将 “comic.ttf” 文件 存放到 web/conf/ 中。 对应修改访问代码。</li><li>浏览器中，“注册” 页面测试！</li></ol><h2 id="微服务实现-图片验证码" tabindex="-1">微服务实现 图片验证码 <a class="header-anchor" href="#微服务实现-图片验证码" aria-label="Permalink to &quot;微服务实现 图片验证码&quot;">​</a></h2><ol><li><p>创建 微服务项目： <code>micro new --type srv bj38web/service/getCaptcha</code></p><p>创建完成，会在项目 bj38web 的 service/ 中，多出 getCaptcha 的微服务项目。</p></li><li><p>修改密码本 —— getCaptcha/proto/getCaptcha.proto</p></li></ol><div class="language-protobuf vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">protobuf</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">syntax</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;proto3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">package</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> go.micro.srv.getCaptcha</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">service</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> GetCaptcha</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	rpc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 使用切片存储图片信息, 用 json 序列化</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> img </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="3"><li><p>编译 proto 文件。 —— make 命令！得到 getCaptcha.micro.go 和 getCaptcha.pb.go</p></li><li><p>修改 service/getCaptcha/main.go</p></li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">github.com/micro/go-micro/util/log</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">github.com/micro/go-micro</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">bj38web/service/getCaptcha/handler</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	getCaptcha </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">bj38web/service/getCaptcha/proto/getCaptcha</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// New Service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	service </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> micro.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		micro.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Name</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;go.micro.srv.getCaptcha&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		micro.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Version</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;latest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// Register Handler</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	getCaptcha.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RegisterGetCaptchaHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(service.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Server</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">handler</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetCaptcha</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// Run service</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> service.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Run</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">		log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Fatal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ol start="5"><li><p>修改服务发现 ： mdns ——&gt; consul</p><ol><li><p>初始化consul</p></li><li><p>添加 consul 到 micro.NewSerive( )</p></li></ol></li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">consulReg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> consul.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewRegistry</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// New Service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">service </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> micro.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    micro.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Address</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;192.168.6.108:12341&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 防止随机生成 port </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    micro.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Name</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;go.micro.srv.getCaptcha&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    micro.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Registry</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(consulReg),				</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 添加注册</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    micro.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Version</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;latest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="3"><li><p>启动 consul ， consul agent -dev</p></li><li><p>修改 handler/getCaptcha.go 文件。</p><ol><li><p>删除 除 Call 以外的 其他 所有函数。—— 受 .proto 文件制约。</p></li><li><p>清空 Call 方法。准备添加具体实现代码。</p></li><li><p>将 之前实现的图片验证码测试模块代码， 剪切到 Call方法中。</p></li><li><p>在 getCaptcha/ 下 ， 添加 conf/comic.ttf</p></li><li><p>将 生成的图片验证码，写成 json 序列化数据， 通过 rsp 参数传出！</p></li></ol></li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">e </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GetCaptcha</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">req</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getCaptcha</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">rs</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getCaptcha</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Response</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 生成图片验证码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 初始化对象</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> captcha.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 设置字体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetFont</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;./conf/comic.ttf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 设置验证码大小</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetSize</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 设置干扰强度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetDisturbance</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(captcha.NORMAL)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 设置前景色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetFrontColor</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">color</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 设置背景色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">SetBkgColor</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">color</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">color</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">RGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">127</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">coloRGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 生成字体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	img, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> cap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Create</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, captcha.NUM)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 将 生成成的图片 序列化.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	imgBuf, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> json.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Marshal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(img)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 将 imgBuf 使用 参数 rsp 传出</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">	rsp.Img </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> imgBuf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="web端对接微服务实现" tabindex="-1">web端对接微服务实现 <a class="header-anchor" href="#web端对接微服务实现" aria-label="Permalink to &quot;web端对接微服务实现&quot;">​</a></h2><ol><li><p>拷贝密码本。 将 service 下的 proto/ 拷贝 web/ 下</p></li><li><p>在 GetImageCd() 中 导入包，起别名：</p><p><code>getCaptcha &quot;bj38web/web/proto/getCaptcha&quot; </code></p></li><li><p>指定consul 服务发现：</p></li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 指定 consul 服务发现</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">consulReg </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> consul.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewRegistry</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">consulService </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> micro.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    micro.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Registry</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(consulReg),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="4"><li>初始化客户端</li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">microClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> getCaptcha.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NewGetCaptchaService</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;getCaptcha&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, consulService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">())</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="5"><li>调用远程函数</li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">resp, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> microClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Call</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">TODO</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(), </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getCaptcha</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;未找到远程服务...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="6"><li>将得到的数据,反序列化,得到图片数据</li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> img </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">captcha</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Image</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">json.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Unmarshal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(resp.Img, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">img)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="7"><li>将图片写出到 浏览器.</li></ol><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">png.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">Encode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(ctx.Writer, img)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="8"><li><p>测试：</p><ol><li>启动 consul ， consul agent -dev</li><li>启动 service/ 下的 main.go</li><li>启动 web/ 下的 main.go</li><li>浏览器中 192.168.IP: port/home 点击注册 查看图片验证码！</li></ol></li></ol><h2 id="连接形式" tabindex="-1">连接形式 <a class="header-anchor" href="#连接形式" aria-label="Permalink to &quot;连接形式&quot;">​</a></h2><ul><li>长连接： <ul><li>TCP。—— 有状态！</li></ul></li><li>短连接： <ul><li>http。—— 无状态！断开后，再发送请求，与上次发送无关！ <ul><li>选用带有 “时效性” 的介质，存储。 —— redis数据库。setex --- expire。</li></ul></li></ul></li></ul>`,52)]))}const y=i(p,[["render",h]]);export{c as __pageData,y as default};
