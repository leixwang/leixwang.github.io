import{j as a,c as n,b as e,ag as i}from"./chunks/framework.BlzMDYBM.js";const b=JSON.parse('{"title":"Ubuntu 16.04下Shadowsocks服务器端安装及优化","description":"","frontmatter":{},"headers":[],"relativePath":"linux/sh.md","filePath":"linux/sh.md","lastUpdated":1744879674000}'),p={name:"linux/sh.md"};function l(t,s,r,h,c,d){return e(),n("div",null,s[0]||(s[0]=[i(`<h1 id="ubuntu-16-04下shadowsocks服务器端安装及优化" tabindex="-1">Ubuntu 16.04下Shadowsocks服务器端安装及优化 <a class="header-anchor" href="#ubuntu-16-04下shadowsocks服务器端安装及优化" aria-label="Permalink to &quot;Ubuntu 16.04下Shadowsocks服务器端安装及优化&quot;">​</a></h1><p>本教程旨在提供简明的Ubuntu 16.04下安装服务器端Shadowsocks。不同于Ubuntu 16.04之前的教程，本文抛弃initd，转而使用Ubuntu 16.04支持的Systemd管理Shadowsocks的启动与停止，显得更为便捷。优化部分包括BBR、TCP Fast Open以及吞吐量优化。 本教程仅适用于Ubuntu 16.04及之后的版本，基于Python 3，支持IPv6。</p><h2 id="安装pip" tabindex="-1">安装pip <a class="header-anchor" href="#安装pip" aria-label="Permalink to &quot;安装pip&quot;">​</a></h2><p>本教程使用Python 3为载体，因Python 3对应的包管理器pip3并未预装，首先安装pip3：</p><div class="language-Bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> python3-pip</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="安装shadowsocks" tabindex="-1">安装Shadowsocks <a class="header-anchor" href="#安装shadowsocks" aria-label="Permalink to &quot;安装Shadowsocks&quot;">​</a></h2><p>因Shadowsocks作者不再维护pip中的Shadowsocks（定格在了2.8.2），我们使用下面的命令来安装最新版的Shadowsocks：</p><div class="language-Bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">pip3</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> https://github.com/shadowsocks/shadowsocks/archive/master.zip</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装完成后可以使用下面这个命令查看Shadowsocks版本：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> ssserver</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>目前会显示“Shadowsocks 3.0.0”。</p><p>创建配置文件 创建Shadowsocks配置文件所在文件夹：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> /etc/shadowsocks</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;配置文件&quot;">​</a></h3><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> /etc/shadowsocks/config.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>需要在<code>/etc/</code>目录下创建一个<code>shadowsocks.json</code>的文件, 配置文件内容如下:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>    &quot;server&quot;:&quot;my_server_ip&quot;,</span></span>
<span class="line"><span>    &quot;server_port&quot;:8388,</span></span>
<span class="line"><span>    &quot;local_address&quot;: &quot;127.0.0.1&quot;,</span></span>
<span class="line"><span>    &quot;local_port&quot;:1080,</span></span>
<span class="line"><span>    &quot;password&quot;:&quot;mypassword&quot;,</span></span>
<span class="line"><span>    &quot;timeout&quot;:300,</span></span>
<span class="line"><span>    &quot;method&quot;:&quot;rc4-md5&quot;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>各字段的含义：</p><table tabindex="0"><thead><tr><th style="text-align:left;">name</th><th style="text-align:center;">info</th></tr></thead><tbody><tr><td style="text-align:left;">server</td><td style="text-align:center;">服务器 IP (IPv4/IPv6)，注意这也将是服务端监听的 IP 地址</td></tr><tr><td style="text-align:left;">server_port</td><td style="text-align:center;">服务器端口</td></tr><tr><td style="text-align:left;">local_port</td><td style="text-align:center;">本地端端口</td></tr><tr><td style="text-align:left;">password</td><td style="text-align:center;">用来加密的密码</td></tr><tr><td style="text-align:left;">timeout</td><td style="text-align:center;">超时时间（秒）</td></tr><tr><td style="text-align:left;">method</td><td style="text-align:center;">加密方法，&quot;rc4-md5&quot;</td></tr></tbody></table><p>测试Shadowsocks配置 首先记录下服务器的IP地址</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ifconfig</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>找到IPv4地址（和IPv6地址），如我的ifconfig输出为</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span>eth0      Link encap:Ethernet  HWaddr 46:91:89:4e:c1:52</span></span>
<span class="line"><span>          inet addr:138.68.51.55  Bcast:138.68.63.255  Mask:255.255.240.0</span></span>
<span class="line"><span>          inet6 addr: fe80::4491:89ff:fe4e:c152/64 Scope:Link</span></span>
<span class="line"><span>          inet6 addr: 2604:a880:2:d0::3727:7001/64 Scope:Global</span></span>
<span class="line"><span>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span></span>
<span class="line"><span>          RX packets:102667 errors:0 dropped:0 overruns:0 frame:0</span></span>
<span class="line"><span>          TX packets:7869 errors:0 dropped:0 overruns:0 carrier:0</span></span>
<span class="line"><span>          collisions:0 txqueuelen:1000</span></span>
<span class="line"><span>          RX bytes:151166937 (151.1 MB)  TX bytes:1151476 (1.1 MB)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>所以我的IPv4地址是138.68.51.55，IPv6地址是2604:a880:2:d0::3727:7001。</p><p>然后来测试下Shadowsocks能不能正常工作了：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ssserver</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> /etc/shadowsocks/config.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>在Shadowsocks客户端添加服务器，如果你使用的是我提供的那个配置文件的话，地址填写你的IPv4地址或IPv6地址，端口号为8388，加密方法为aes-256-cfb，密码为你设置的密码。然后设置客户端使用全局模式，浏览器登录Google试试应该能直接打开了。</p><p>这时浏览器登录<a href="http://ip138.com/%E5%B0%B1%E4%BC%9A%E6%98%BE%E7%A4%BAShadowsocks%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84IP%E5%95%A6%EF%BC%81" target="_blank" rel="noreferrer">http://ip138.com/就会显示Shadowsocks服务器的IP啦！</a></p><p>测试完毕，按Ctrl + C关闭Shadowsocks。</p><p>配置Systemd管理Shadowsocks 新建Shadowsocks管理文件</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> /etc/systemd/system/shadowsocks-server.service</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>复制粘贴：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=Shadowsocks Server</span></span>
<span class="line"><span>After=network.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>ExecStart=/usr/local/bin/ssserver -c /etc/shadowsocks/config.json</span></span>
<span class="line"><span>Restart=on-abort</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Ctrl + O保存文件，Ctrl + X退出。</p><p>启动Shadowsocks：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> shadowsocks-server</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>设置开机启动Shadowsocks：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> shadowsocks-server</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>至此，Shadowsock服务器端的基本配置已经全部完成了！</p><h1 id="优化" tabindex="-1">优化 <a class="header-anchor" href="#优化" aria-label="Permalink to &quot;优化&quot;">​</a></h1><p>这部分属于进阶操作，在你使用Shadowsocks时感觉到延迟较大，或吞吐量较低时，可以考虑对服务器端进行优化。</p><h2 id="开启bbr" tabindex="-1">开启BBR <a class="header-anchor" href="#开启bbr" aria-label="Permalink to &quot;开启BBR&quot;">​</a></h2><p>BBR系Google最新开发的TCP拥塞控制算法，目前有着较好的带宽提升效果，甚至不比老牌的锐速差。</p><h2 id="升级linux内核" tabindex="-1">升级Linux内核 <a class="header-anchor" href="#升级linux内核" aria-label="Permalink to &quot;升级Linux内核&quot;">​</a></h2><p>BBR在Linux kernel 4.9引入。首先检查服务器kernel版本：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uname</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> -r</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果其显示版本在4.9.0之下，则需要升级Linux内核，否则请忽略下文。</p><p>更新包管理器：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> update</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查看可用的Linux内核版本：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> apt-cache</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> showpkg</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> linux-image</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>找到一个你想要升级的Linux内核版本，如“linux-image-4.10.0-22-generic”：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> linux-image-4.10.0-22-generic</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>等待安装完成后重启服务器：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> reboot</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>删除老的Linux内核：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> purge-old-kernels</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>开启BBR 运行<code>lsmod | grep bbr</code>，如果结果中没有tcp_bbr，则先运行：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">modprobe</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> tcp_bbr</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;tcp_bbr&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> /etc/modules-load.d/modules.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>运行：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;net.core.default_qdisc=fq&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> /etc/sysctl.conf</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;net.ipv4.tcp_congestion_control=bbr&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> /etc/sysctl.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>运行：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> -p</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>保存生效。运行：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sysctl</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> net.ipv4.tcp_available_congestion_control</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sysctl</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> net.ipv4.tcp_congestion_control</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>若均有bbr，则开启BBR成功。</p><p>优化吞吐量 新建配置文件：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> /etc/sysctl.d/local.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>复制粘贴：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span># max open files</span></span>
<span class="line"><span>fs.file-max = 51200</span></span>
<span class="line"><span># max read buffer</span></span>
<span class="line"><span>net.core.rmem_max = 67108864</span></span>
<span class="line"><span># max write buffer</span></span>
<span class="line"><span>net.core.wmem_max = 67108864</span></span>
<span class="line"><span># default read buffer</span></span>
<span class="line"><span>net.core.rmem_default = 65536</span></span>
<span class="line"><span># default write buffer</span></span>
<span class="line"><span>net.core.wmem_default = 65536</span></span>
<span class="line"><span># max processor input queue</span></span>
<span class="line"><span>net.core.netdev_max_backlog = 4096</span></span>
<span class="line"><span># max backlog</span></span>
<span class="line"><span>net.core.somaxconn = 4096</span></span>
<span class="line"><span></span></span>
<span class="line"><span># resist SYN flood attacks</span></span>
<span class="line"><span>net.ipv4.tcp_syncookies = 1</span></span>
<span class="line"><span># reuse timewait sockets when safe</span></span>
<span class="line"><span>net.ipv4.tcp_tw_reuse = 1</span></span>
<span class="line"><span># turn off fast timewait sockets recycling</span></span>
<span class="line"><span>net.ipv4.tcp_tw_recycle = 0</span></span>
<span class="line"><span># short FIN timeout</span></span>
<span class="line"><span>net.ipv4.tcp_fin_timeout = 30</span></span>
<span class="line"><span># short keepalive time</span></span>
<span class="line"><span>net.ipv4.tcp_keepalive_time = 1200</span></span>
<span class="line"><span># outbound port range</span></span>
<span class="line"><span>net.ipv4.ip_local_port_range = 10000 65000</span></span>
<span class="line"><span># max SYN backlog</span></span>
<span class="line"><span>net.ipv4.tcp_max_syn_backlog = 4096</span></span>
<span class="line"><span># max timewait sockets held by system simultaneously</span></span>
<span class="line"><span>net.ipv4.tcp_max_tw_buckets = 5000</span></span>
<span class="line"><span># turn on TCP Fast Open on both client and server side</span></span>
<span class="line"><span>net.ipv4.tcp_fastopen = 3</span></span>
<span class="line"><span># TCP receive buffer</span></span>
<span class="line"><span>net.ipv4.tcp_rmem = 4096 87380 67108864</span></span>
<span class="line"><span># TCP write buffer</span></span>
<span class="line"><span>net.ipv4.tcp_wmem = 4096 65536 67108864</span></span>
<span class="line"><span># turn on path MTU discovery</span></span>
<span class="line"><span>net.ipv4.tcp_mtu_probing = 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>net.ipv4.tcp_congestion_control = bbr</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>运行：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --system</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>编辑之前的shadowsocks-server.service文件：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> /etc/systemd/system/shadowsocks-server.service</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>在ExecStart前插入一行，内容为：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span>ExecStartPre=/bin/sh -c &#39;ulimit -n 51200&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>即修改后的shadowsocks-server.service内容为：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=Shadowsocks Server</span></span>
<span class="line"><span>After=network.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>ExecStartPre=/bin/sh -c &#39;ulimit -n 51200&#39;</span></span>
<span class="line"><span>ExecStart=/usr/local/bin/ssserver -c /etc/shadowsocks/config.json</span></span>
<span class="line"><span>Restart=on-abort</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Ctrl + O保存文件，Ctrl + X退出。</p><p>重载shadowsocks-server.service：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> daemon-reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>重启Shadowsocks：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> shadowsocks-server</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>开启TCP Fast Open TCP Fast Open可以降低Shadowsocks服务器和客户端的延迟。实际上在上一步已经开启了TCP Fast Open，现在只需要在Shadowsocks配置中启用TCP Fast Open。</p><p>编辑config.json：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> /etc/shadowsocks/config.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>将fast_open的值由false修改为true。Ctrl + O保存文件，Ctrl + X退出。</p><p>重启Shadowsocks：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> shadowsocks-server</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>注意：TCP Fast Open同时需要客户端的支持，即客户端Linux内核版本为3.7.1及以上；你可以在Shadowsocks客户端中启用TCP Fast Open。</p><p>至此，Shadowsock服务器端的优化已经全部完成了！</p><h1 id="center-os-install-bbr" tabindex="-1">center os install BBR <a class="header-anchor" href="#center-os-install-bbr" aria-label="Permalink to &quot;center os install BBR&quot;">​</a></h1><p>安装wget</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> wget</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">//</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> 执行BBR</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> PLUS修正版一键脚本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> -N</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> --no-check-certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> tcp.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">./tcp.sh</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">\`\`</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,94)]))}const u=a(p,[["render",l]]);export{b as __pageData,u as default};
